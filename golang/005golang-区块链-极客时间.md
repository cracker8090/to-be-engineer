[toc]



# P2P技术详解

## 问题

1.是不是每個節點都要同步所有的交易數據（礦工打包的）到本地，如果交易文件總量的大小超過1T（簡單的舉例），而每個節點的可用容量沒有1T，會怎麼樣？ 而且同步過大的數據也會有效率問題吧。。。 求老師解答下，謝謝~

作者回复: 节点也分种类，常见的最安全最完整的节点就是必须同步所有交易数据。目前比特币和以太坊两个公链大概在500~800GB，随着时间增长的确会突破1T。
实际上已经同步到最新的节点，效率是不变的。
常见的方案有区块数据快照，这个在EOS公链经常使用，就是别人在全球各地放置快照镜像，大家可以通过加速下载的方式快速获得区块数据快照，而不必从0开始同步。
通常还有节点轻模式，这种模式只用同步区块头，而不必同步区块数据，延迟到用时取关联区块就行了。

节点存储的问题目前还不太严峻，实际上目前很多云厂商都可以支持超过2T以上的存储空间，撑十几年不成问题的。技术上的探索有简化验证，轻模式，压缩都是可以的。



# **共识机制** 

共识机制主要解决了两个问题：

- 谁有权利；
- 作弊问题。

## **最经典的入门型共识机制：PoW 工作量证明** 

在 PoW 这种机制中，计算资源（又称算力）是决定记账权的唯一因素。与之对应的，便是计算难度。

强大的计算资源突然加入以后，肯定会让整个系统的产生答案的速度变快很多，作为系统本身会自适应，将难度提升，降低答案产生的速度。

PoW 到底是如何避免作弊者的呢？答案就是计算资源（算力）。

怎么进行抗击的呢？整个过程是这样的，理性的人如果作弊、篡改账本肯定需要投入成本，也就是计算资源，收益是篡改账本获得的收益减去投入成本，这个收益往往小于诚实计算所获得的收益。所以，作弊者在作弊过程中投入的计算资源过大，反而得不偿失。

## **PoW 工作量证明的补充：解决双花攻击** 

作弊的收益往往小于诚实计算的收益。这一点其实对应到区块链领域有个著名的问题：双花攻击（double-spending） 。

所有记账节点都会遵循以下两条规则：

	规则一：一个代币如果已经被花费，那么会被标记成已花费，如果再次接收到这个代币被花费的请求，那么记账节点会拒绝打包这笔交易；
	
	规则二：如果同时接收到两个信封，这两个信封中装的两笔交易出现了一个代币被花费了两次的情况，这种情况也就是我们所说的分叉（Fork），那么选择挖矿难度比较大的那个信封。

规则一避免了未确认的交易出现双花，规则二基本避免已经确认的交易中（信封中）的双花问题。

	假设作弊者的计算资源（算力）占整个系统的 30%，那么连续两次获得记账权的概率是 9%，看起来作弊的可能性还是挺高的，如果是连续 6 次获得记账权呢？概率直降到万分之七。
	
	在比特币中，这个 6 也就是 6 次确认，表示连续 6 个块过去了，如果我的交易没有被双花的话，那么它被篡改的可能性将越来越小，最后变得几乎不可能被篡改。这也是区块链不可被篡改说法的由来。
	
	试想，如果任何作弊者花了大量的成本获取了系统 30% 的计算资源（算力），最后只有万分之七的概率获得篡改的可能性，比起作弊，还不如诚实记账的收益高。



## 问题

PoW算法的特色是结合了经济学上理性人的假说，发明了激励机制，让做好人的奖励大于做坏人的获利。但我觉得比特币每4年递减的特点可能会导致这个天平被打破，比特币奖励越来越少，而比特币总量越来越多，是否意味着某一天可能作恶的收益要大于做好人的收益呢？

作者回复: 1. 可能的，不过这个周期非常长，临界点可能在这个世纪末，但由于不确定因素非常多，多因素综合，例如到时比特币100万美金一个，即使低收益只要可以覆盖成本即可，而且作弊是概率的，只有期望值。所以足够的时间会发现新的算法来修正PoW，或切换其他共识

2. 比特币的总量是恒定的



1双花攻击中后一个区块如何验证前一个区块是否“作弊”
2区块链产生分叉后，新产生的区块如何“选择”加入哪一个分支

作者回复: 你好。

1. 每一笔交易记录都是有前向输入的，如果已经被花费过，则状态已经变更为已花费，再次话费共识验证的代码会检验不过，拒绝被打包。这个我曾经在比特币上干过，修改本地节点代码后发起攻击，交易不会被打包，除非全球的矿池同时重启，也是概率会成功，仅限未被确认的交易。

2. 通俗说法叫做所有节点跟随最长的一条分叉链，共识代码规定的。专业的说法叫做“难度”累积最大的一条链。



作者回复: 币是业务逻辑，区块是技术逻辑。币是网站积分，区块是数据库的表。



原交易不被篡改是由非对称加密保证的，这里说的共识是大家达成一致记录，不被扰乱的过程。



如果币全部被挖掘出来，那么旷工是不是没有存在的意义了？？？那么之前讲过每笔交易都要旷工加一个信封，那币挖完之后要继续交易的信封怎么办？

作者回复: 可以改共识，形成微通胀模型。
也可以通过提高手续费



上一讲的问答中提到，没有交易的空区块也存在。
是否会有多个未满的区块？如果是，那么一批未确认的交易被记在哪个区块是如何被选定的？

作者回复: 一般都是未满的区块占多。是由矿工的内存池决定的，都是随机的。



交易算作确认的条件
1.交易存在于最长分的一个区块中
2.后面至少有5个区块被验证过

作者回复: 是的，这是比特币的确认条件。



每一个区块里都保存着所有的交易信息吗？还是说要获取所有交易信息需要一直往上遍历？

作者回复: 后者。



打的比喻：挖矿产生的区块相当于数据库，而比特币相当于积分，这个怎么理解呢？这是说比特币是写在对应区块的一笔交易记录吗？还有是不是每产生一个区块就会派发一个比特币？比特币归属怎么来记录呢？每个区块里边是不是可以无限追加交易记录？我这还没入门，希望老师赐教哈

作者回复: 1. 积分记录在数据库的表中，谁有权利创建新表，谁就能获得积分。

2. 比特币是表中有效的未花费记录
3. 一个区块就是一张新表，表可以哈希后串起来
4. 不是无限的，有区块容量限制



所謂一個区块被打包 需要6次确认 是判断拥有6次记账权？还是什么意思 ，所谓的6次确认是怎么确认的 谢谢

作者回复: 一次确认就代表已经刚刚被打包进区块，两次确认就代表又产生了一个新块引用这个区块，链式引用，引用越多就代表被篡改的可能性越小，6个确认是在概率上认定为基本不可能被篡改了，所以6次只是一个建议，由用户自己选择的，当前比特币网络很稳定，一般1~2就可以认定有效，以太坊一般是12个。



不明白为什么六个6就保证安全了。为什么不是5个六。七个六。

作者回复: 你好，这在中本聪的白皮书中有计算哦，呈指数下降，6个以后被追赶超过的概率将非常低，大约万分之2.4，当然7个也是可以的，只是从概率上来说都已经是小概率了。5个概率是万分之9。

Alexcsl的问题，不是说一定是6次，只是比特币规定要六次都正确，才是交易完成的。我是观看下来这么理解的

作者回复: 6是一个概率确定，几乎可认为不可被双花攻击。这个在白皮书中是有计算证明的。6次确认又称作成熟过程。成熟的区块，业界共认为不可篡改了。不同区块链上这个值是不同的。



用户的当前token数量是怎么维护的，是要从当前区块一直回溯到创世区块，遍历所有和自己相关的Transaction才能计算出来吗？

作者回复: 是的，后面有一篇文章 《数字货币钱包服务》里有介绍扫块



比特币的机制能够更改吗？如果未来发现漏洞可以补救吗？

作者回复: 可以的，通过BIP修改的



比特币的价值在哪里？只是一堆人搞了硬件在挖，好像是浪费资源啊，对社会的贡献在哪里？比特币像是凭空制造的货币。望解惑

作者回复: 去中心化不可篡改的记账啊，信用货币也是凭空造的，只不过锚定物不同。黄金也没有锚定物



比特币的价值在哪里？只是一堆人搞了硬件在挖，好像是浪费资源啊，对社会的贡献在哪里？比特币像是凭空制造的货币。望解惑

作者回复: 去中心化不可篡改的记账啊，信用货币也是凭空造的，只不过锚定物不同。黄金也没有锚定物





# 区块链应用类型

## 数字货币应用方向

到底如何理解数字货币这个概念呢？其实你可以简单理解为一种无主权、社区自治的货币形式

数字货币的运行则通常是靠社区自治的，所谓社区自治，是指用户、维护者、开发者三种角色共同决定数字货币的发展，也就对应了上一篇文章中，我们所讲到的“共识”。

数字货币，通常具有下面几个特点

**1.总量透明公开 ** 

	白皮书通常是一个区块链项目公开发布的一种阐述性文档，其中简述了项目的宗旨和愿景以及设计蓝图。在白皮书中，这个项目总共发行多少数字货币，投资者、用户、矿工能够获得多少也都是事先分配好的。数字货币的总量也分为两种，一种是总量设上限的，另外一种是不设上限的。

**2.数字货币缓慢释放** 

**3.代码执行规则** 

在白皮书中规定好了总量和数字货币释放的机制，白皮书的内容会成为整个社区的基础共识，所以在项目的主网上线之后，数字货币的释放不再是人为控制，而是在代码层面体现，代码将负责控制数字货币的释放，这里去除了人为操作的因素。

## 数字资产方向

	虚拟资产一般包括有金融资产、游戏代币、数字版权、域名、用户流量等。由于虚拟资产不需要与实体资产进行挂钩，所以在对应到区块链上更为方便。它具体的应用形式在供应链金融、票据市场都有所体现。
	
	区块链圈子内有个非常有名的加拿大白胡子大叔。“良心区块链”，比如今天我给自己设定了一个跑 10 公里的目标，如果我完成了，那么我会在系统上获得代币，如果没有完成，则有相应的惩罚机制。
	
	比如我们可以让 TF-Boys 每位成员都可以发行属于自己的区块链积分，并与粉丝一起共同持有。在未来，根据偶像成长和走红的程度，偶像可以与粉丝一起分享收益。
	
	除了数字货币，数字资产也是区块链的一个应用方向。数字资产的应用形式与资产证券化（ABS）十分类似，感兴趣的读者可以自行研究一番。

## 比较成熟的应用类型

	任何的区块链创始项目如果要活下去，就要先解决钱的问题，也就是融资问题。任何的区块链项目基本都会产生一个基础代币，那么什么样的融资模式能让投资者和项目方都满意呢？

这个融资模式本身就是一个很成熟的应用。——答案是去年被七部委明令禁止的 ICO(Initial Coin Offering)。

	ICO 的中文名是首次代币发行，又称为区块链众筹，这是一种新型的融资模式，投资者可以用手中的比特币或其他代币投到一些区块链创始项目。
	
	一个区块链项目发起之后，如果选择发起 ICO，相比传统融资渠道，项目方会在很短的时间内融到资，且白皮书中规定好的代币将一次性地投放到投资者手里，并在短时间内上线数字资产交易平台。
	
	如果 ABC 代币会在一个月内上线交易平台，假设 ABC 的价格波动超过 50%，那么马先生的 1 万的 ABC 代币可以交易成 1.5 个比特币，马先生纯赚 0.5 个比特币，并且他可以抽身这个项目，再次参加新一轮的 ICO。
	
	ICO 技术虽然为所有区块链项目提供了周期短、效率高的融资模式，但在同时，ICO 也成了传销和内幕交易的重灾区。

以上举例说明了区块链在虚拟资产下的应用模式，而另外一个高产虚拟资产的领域——游戏领域，也是区块链同化的对象。

比较有名的是 2017 年走红的以太坊“养猫”游戏。试想，你在游戏里的道具，如果可以在其他任何游戏进行使用，感觉是不是很棒。虽然目前还没有现象级的游戏被区块链同化的例子，不过你也可以发散思维，构想一些新的区块链游戏模式。

当然除了虚拟资产，实体资产也可以用区块链进行应用，但是目前遇到的难题基本都是实体资产如何与链上区块链的数据进行一一映射。

这涉及了数据公证等等环节，实施起来比中心化应用困难很多，比较典型的例子是区块链与供应链结合，解决信息流、资金流、物流，“三流”合一的问题。

除了实体资产和虚拟资产，区块链最简单直接的应用还有公证公示领域，不过这里仅仅用到了区块链“不可篡改”的特性。



区块链的应用范围目前多被局限在金融领域。所以，理性看待区块链的应用可以让我们更好地去应用区块链。那么还有哪些行业，可以使用区块链进行数字化呢？



## 问题

最近想到一个应用场景，关于人员身份的记录与追溯。身份可追溯，是否就对走失儿童，拐卖儿童等事件有好的帮助。

tensorflow-boys

作者回复: 嗯，送你上去。和人工智能的结合还有有巨大的空间可以挖掘，可以尝试一下

yue pao软件应当应用区块链不可篡改的特性，这样的话女生意外怀孕就有据可查，更不会出现小孩找不到父母的尴尬局面。

公司财务审计可以用区块链自动执行。



抱歉，不太懂旅游行业。
建议从痛点和需求出发，看看区块的特性能否解决，一般就是不可篡改特性，自定义token特性。

手机是不是可以应用区块链，目前大部分手机功能依赖与连接到网络发送指令。区块链后可以利用终端命令对自己的手机控制，是否就减少手机丢失的问题。



作者回复: 可以是可以。
问题是没有厂家支持，苹果和大安卓厂商都有自己的找回服务哦。
场景可以再扩展发挥一下说不定有惊喜



中心化的数字公证可以由信誉度高的中心化机构来证明，但是区块链网络中找到一个节点来进行公正很难。一种方法是像联盟链一样让可信任的节点进行认证，另一种方法是讲实体认证进行公示。

作者回复: 你好，有关数字公证其实依赖区块链数字身份基础设施，这块属于研究前沿，还未有实际落地方案。



陈老师，您对区块链在电子发票上应用的业务流程和实现方式是否有所研究？可否赐教？多谢！

作者回复: 你好，电子发票应用算是区块链的一个案例，不算是典型的应用。具体是哪方面的逻辑呢？可以提出我们一起讨论。



请问白胡子大叔的区块链项目具体叫啥名？想详细了解下，Google 百度上都没找到…

作者回复: 你好，白胡子大叔中文名 大龙，加拿大人。可以谷歌 conscienceland



通过区块链，可以聚集一群有共识的人，他们都认同这个链的价值。

区块链一定要以明晃晃的赚钱作为目的吗？不是的。

正如，良心链的代币价值在哪里？用代码到用户所做的事情来评价应得的奖励，用规则来限制用户可做的事情，然后这个代币就可以开始产生价值了，因为这是付出了劳动而获得的。假如代币出现供需不平衡，那么价格就会上涨。

为什么人们要去抢这么些代币？他代表了什么价值？
还是有很多不懂的点。

不过总的来说，一个好的区块链，必须要有：
1，限制规则
2，评价准则
3，代币价值

作者回复: 鼓掌



如果只有自己能操作的话，一旦私钥丢失就破产了，这个机制在现实生活中有一定推广难度，有什么解决办法让用户缓解这种危机情绪吗

作者回复: 做好备份即可，用户也可以购买硬件钱包进行存储。去中心化必然会带来这个问题，也可以通过中心化托管的方式进行推广。



教育行业，小学生每完成一次作业就进行一定的通证奖励，及时正面反馈



# 数字货币与区块链的关系

	**数字货币**通常是基于区块链技术、在全球范围内公开发行的、并且没有任何国家政府背书的虚拟货币，这种虚拟货币具有“去信任”、“点对点”、“公开记账”、“不可篡改”等特征。

既然聊到了虚拟货币，我们正好可以把电子货币、虚拟货币、数字货币（加密货币）的概念捋一捋。

## 电子货币

	电子货币和数字货币一样都是无形的，但是电子货币其实就是将法币电子化，例如第三方支付平台，银行卡电子现金，银行大小额支付系统等等。

## 虚拟货币

	在 2017 年区块链投机狂热的时候，“虚拟货币”这个词基本是用来指区块链项目的基础代币，这样的叫法大多源自于圈外投机者。其实不然，虚拟货币所指代的概念远比电子货币以及数字货币都要更加广泛。

虚拟货币通常是由非金融机构发行的非实体货币，大致分为三类。

- 第一类比如游戏代币，通常不与实体经济发生联系。例如在《王者荣耀》这款游戏中，如果你想要得到新的道具，就必须有足够的游戏代币（钻石和点券），这种虚拟货币还有个特征就是封闭性，即只能在这款游戏中使用。

- 第二类是积分类，它可以与实体经济发生联系，比如常旅客积分，超市礼品卡，这种虚拟货币也有个特征叫做单向性，即只能流入，而不能流出。

- 第三类自然就是我们主要讲的数字货币（加密货币）了，比特币便是其中典型

## 数字货币

数字货币一般是指公有区块链平台底下的基础代币，该代币被记录在由密码学保证的一套公开账本上，与传统货币不同的是，由于去中心化以及可编程等特性，此种货币具有可自定义行为的属性。

在比特币中，我们可以定义多重签名交易来实现真正意义上的“由多人共同掌管的机构型账户”。

比如，在元界上，用户可以自定义交易的行为，例如在转账时可以指定代币的一个锁定期，并且指定解锁条件；而在比特股中，这种行为更被强化为具有衍生品特性的货币，这在传统货币领域是不可想象的。



### 传统货币与数字货币

#### 匿名性 vs 实名制

由于区块链上未提供 KYC（Know Your Customer）功能。

这样的缺点主要是因为不少公链代币设计中没有加入身份的概念，不过这在我这样的技术人的角度来看，只是算是一个需求，而不是数字货币本身存在的缺陷。

#### 点对点 vs 中心化

数字货币的发行主体通常是项目发起方，并且会在白皮书中定义好数字货币的发行过程；在主网上线以后，所有的代币会根据一开始设计好的发行过程缓慢释放到市场，这个过程其实就是大家喜闻乐见的“挖矿”过程。

从某种意义上来说，央行模式是中心化的极致体现，而数字货币则属于点对点机制的体现。

#### 自理型安全性 vs 托管型安全性

只要数字货币基础的加密算法不被攻破，并且保护好私钥，你的资产便是真正意义上、只属于你自己的资产。

传统货币的交易过程最终是落到银行的，所以银行系统的安全性决定了传统货币在使用过程中的安全阈值，这也表示你的资产是托管在银行的。

#### 广区域流通 vs 国家内部流通

普通人已经接受了信用货币这种设定，目前对数字货币的接受度在各国并不一样，例如在中国大陆接受度低，在日本接受度高。

### 数字货币的发行过程

矿工每挖出一个区块，也就是在第二篇文章中提到的“打包一个信封”，会产生一个 Coinbase 交易，这个 Coinbase 交易相当于凭空产生了币，矿工可以从 Coinbase 获得比特币，作为维护系统的奖励。

Coinbase 的产出是每 4 年衰减一半的，第一个 4 年是挖出每个块 50 个比特币，第二个 4 年的周期就是挖出每块产出 25 个，目前比特币处于第三个 4 年，Coinbase 产出 12.5 个比特币的阶段。

以上逻辑是比特币白皮书和比特币代码规定好的，所有比特币的参与者可以进行验证。并且根据以上逻辑，我们可以画出如下的发行曲线

![BTC.png](https://upload-images.jianshu.io/upload_images/12461256-a831091545cd7ba9.png?imageMogr2/auto-orient/strip|imageView2/2/w/570/format/webp)

我们可以看到，比特币的发行过程每隔四年发生一次改变，发行速率逐渐降低，随着时间推移趋于平缓。

同理，我们在其他数字货币项目就可以看到类似曲线，不过它们未必与比特币的发行曲线一样，有可能是离散式的，有可能是线性的，这取决于白皮书中规定的发行过程。

例如熵币 ETP 的发行过程也是一个衰减过程，不过 ETP 的衰减系数是 0.95，所以相对比特币可以说更光滑了，它随着时间收敛到挖矿总量 3000 万，那么这个曲线看起来是这样的。

![ETP.png](https://upload-images.jianshu.io/upload_images/12461256-33512fdf8d3dddec.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

数字货币的发行过程可以认为是一个区块链项目的核心利益分配的过程，也是一个社区激励的过程，如何把有限的代币派发给愿意为项目付出的社区人，是考量一个区块链项目运营成熟度的重要指标。

除了社区型的非盈利性开源数字货币项目，央行也在推动基于区块链交易平台，同时，由央行发行的法定数字货币也已经在这种平台上开始试运行。

## 问题

数字世界的交易如何约束物理世界？例如我通过比特币网络支付购买一部手机，但对方收到比特币就是不发货，谁来制约它呢？

作者回复: 你好，目前已经有基于比特币的第三方支付，如bitpay。

另外可以通过信用上链，让作弊成为单次博弈，无法多次使用。

在西方文化中，契约精神是商业的根本，所以相对来说，对比特币更宽容一些。



去中心化带来效率低下，账本每页（区块）不能太大，否则广播给每个节点的速度降低，账本大小被限制导致交易记录的数据量被限制。例如比特币平均一秒钟3-4笔交易。



token通俗讲就是一种凭证，可以是物权凭证，也可以是股权凭证。是一种泛化的登记和记账工具。



发币以后，可以根据大家提交的建议修改游戏规则，那么，这个规则是如何被整体接受的呢

作者回复: 你好，都有的，比特币上叫做BIP，bitcoin improvement proposal 

以太坊 ethererum improvement proposal 
元界 metaverse improvement proposal



要是币都挖完了，接下来该怎么继续运营支撑呢？要扩充币的总量吗

作者回复: 这个周期会非常长，好比政府货币政策不会规划到五十年以后一样。

另外还有一种微通胀模型，也是可以做的。



# 上手数字货币

数字货币作为区块链的第一大应用，拥有巨大的市场，你可以从“ coinmarketcap.com ”上了解几乎所有数字货币的概况。

如果想了解数字货币行情，可以打开 feixiaohao.com 进行查看，也可以手机下载“ MyToken ”或“ 币看”。上面几乎可以查询到所有已经“上市”的数字货币的实时价格与成交量信息。

## 什么是数字货币钱包

数字货币钱包作为数字货币的载体，从技术角度来看，数字货币钱包分为三种类型。

1.全节点钱包。全节点钱包是指官方发行的一种数字货币钱包版本，这个版本包含了完整的功能需求，挖矿、发送交易、查询交易记录、管理私钥。

2.SPV 轻钱包（Simplified Payment Verification）。轻钱包为了用户体验，牺牲了全节点的部分功能，属于全节点钱包的简化版，如挖矿功能、查询交易功能就没有。

3.中心化资产托管钱包。这种钱包其实是第三方服务商帮助你打理你的数字货币，找一个中介托管你的数字货币，比较典型的有 blockchain.info。

以上的第 1 种和第 2 种会在各个数字货币的官网出现，属于真正意义上的数字货币钱包，1 相比 2 而言，安全性要更高；所以我在这里推荐你先从全节点钱包开始尝试，毕竟全节点钱包基本囊括了该币种的所有功能实现。

而第 3 种钱包，与银行移动 App 或支付宝相比，在业务逻辑上区别不大。比如你会把钱托管到支付宝上一样，你也可以将你的数字货币放进第三类钱包中。

这种钱包往往都是多币种的，深受投资用户的喜欢，而且从方便性和用户体验来说，基本完爆 1 和 2，例如以太坊系钱包 imToken，多币种钱包 Jaxx，以及各个数字货币交易平台。

无论是什么类型的钱包，建议你在获取钱包程序的时候，一律要从官网下载，即使是移动端 App 也强烈推荐从官网的入口进入。

## 上手数字货币

以某个币种的全节点钱包作为例子，穿插一些比特币 Electrum 轻钱包的例子，为你介绍数字货币钱包的上手方法。







敲黑板划重点：红字部分又称助记词。这种助记词是为了主私钥服务的，主私钥其实是一串非常长的字母和数字组合，无论是人脑记或者笔记都是非常不容易识别的，容易弄错，助记词的有序组成与主私钥是一一对应的。

如果记录保存好了助记词（红字部分），即使钱包丢失或者被破坏也没有关系，用户可以在其他钱包中导入助记词，依然可以操作资产。

所以说在区块链的世界，主私钥和助记词是操作资产的唯一途径，如果丢失，那么资产就丢失，不存在忘记助记词还能找回资产这回事。

只要保存好了助记词，你的比特币可以在任意（标准版）比特币钱包导入。



钱包地址

钱包地址，也就是对应到我们现在银卡的卡号。在币圈，地址其实也分很多种，我们今天只介绍最简单直观的——支付地址（Payment Address），也就是我们现在要说的钱包地址。现在咱们来看看自己的地址是什么。

在比特币中，地址是以 1 开头的一串字母和数字的组合，字母区分大小写。



目前不存在人民币对数字货币的场内交易平台，所以想用人民币购买数字货币的各位只能选择场外交易，比较有名的平台有 coincola.com

你如果具有投资热情，可以继续挖掘“coinmarketcap”中绿框内的选项



# 区块链常见误区



1. 数字货币没有背书，我为什么要用呢？
2. 数字货币是不是投机炒币？
3. 区块链是不是万能的？
  3.1,在 CAP 中，Consistency 是一致性，表示同样数据在分布式系统中所有地方都是被复制成相同；Availability 是可用性，表示所有在分布式系统活跃的节点都能够处理操作且能响应查询；Partition tolerance 是分区容忍性，表示不同节点之间数据同步有意外情况产生时，能够容错;
4. 去中心化是不是区块链唯一的评价标准？
  4.1 支持去中心化的观点认为：区块链的初衷就是去中心化，所以也衍生出一条准则：“凡是没有做好去中心化指标的系统都不是区块链”。
5. 联盟链为什么没有公有链普及？
  5.1 所谓联盟链，就是这个区块链具有准入许可，不像公链，任何人都可以随时进入，准入许可意味着候选节点进入区块链时，需要得到已经在网络中的节点的许可，所以联盟链也叫做许可链。联盟链的节点数通常不多，维护成本相比公链要低。
6. 区块链是否会颠覆当下互联网？
  很多早期的区块链文章经常说：区块链会颠覆当下的互联网什么的，关于这一点，我其实持保留意见。区块链如何打通与现有互联网的界限还是一个未知数，最大的可能性仍然是区块链成为互联网的一部分，作为底层设施改进了原来互联网的架构。
  独立思考:
  区块链为什么会去挑战货币价值呢?
  为什么选择最难的方式推进?
  逐利者不息?



## 问题

针对微信的聊天社交功能，我觉得完全可以用区块链技术进行代替。原因如下：
1.朋友之间的对话有加密需求。大多数人都不想让别人知道自己和朋友聊了什么，对话内容需要加密，且聊天软件存储的数据尽可能存在数量很多的服务器上，一来减少自己存储数据所需的服务器成本，二来所有数据加密且去中心化提高系统安全性。
2.个人隐私的保护。最近facebook的由于个人隐私的泄露被搞的焦头烂额，如果把每个人的社交账号上面的个人信息，交往的朋友圈子，点赞分享的用户数据全部打包进区块链。大型科技公司如果需要用户数据则向每个用户购买，只有用户交易签名才可以把数据
打包发给公司。这样用户完全可以为自己在网络上的行为为自己挣钱了。



区块链会改变微信和支付宝的地位吗？这个问题的本质是去中心化的应用DAPP会取代中心化应用吗？这个取决于整个社会对安全和效率之间的平衡。在当前中国，大部分人会优先选择效率，从而出让个人隐私。但随着时间的推移，当越来越多的facebook事件出现后，整个社会会越来越向安全这边倾斜，不过个人认为这是个漫长的过程。



“区块链如何处理高频交易”，拿比特币来说，每个区块的认可要60分钟，我们买瓶可乐，商家需要等60分钟肯定是不可行的，但是我不知道有没有办法解决这个问题。

作者回复: 目前有闪电网络等类似小额支付通道的方案，后续会有讲解。



不能寄望区块链保护隐私，我们被每个app侵犯隐私前都点过同意。你能不用微信吗？即使放在区块链上你还是得乖乖点同意交出隐私

作者回复: 同意，区块链隐私有两面性。审查也是必要的。



目前来看就有上千种数字货币。比特币目前每秒最多只能交易七笔。而对于扩容社区出现了巨大的不同意见。分布式和中心话在发展效率上是否有巨大的不同



微信服务是提供信息交流平台，但是个人产生的数据并不是自己的。而区块链既能解决信息传递，更能解决信息回归用户，这点区块链取胜。支付宝，微信支付解决信任问题，而区块链本身就是为解决信任问题而来，只是区块链现在因为法规，无落地项目，大众不知，没有广大用户，监管不严等现实问题，暂时无法取代微信与支付宝，但是从解决问题，提供更好服务，区块链未来是有机会颠覆的。



请问老师，文章提到的区块链模式是不是只有公有链与联盟链两种呢？

作者回复: 你好，区块链的发展距离成书已经快两年啦。
事实证明联盟链其实是披着羊皮的云服务，名存实亡。
目前区块链的划分主要还是以token使用类型规定的，例如稳定币类型，平台类型，新项目类型，底层基础设施类型等等。
联盟链谈的不多了。



如果央行做出数字货币，更需要无政府的数字货币应对，央行的数字货币一定是中心化（银行和云计算商组成的私链）、身份透明、毫无隐私的

作者回复: 去的是自己的技术中心，提高效率为主，主权仍然是中央的



我觉得以前是公有链，现在慢慢都会转向私有链，在以后会转向联盟链，那时公有链可能会淘汰掉很多，而且被边缘化

作者回复: 你好，我们观点不同哦，我认为恰恰相反，也会共存。



其实支付宝和微信也可以转型的，参考bitpay。毕竟用户流量是优势基础呢



我觉得区块链不会改变支付宝和微信的地位，但会促进支付宝和微信进行底层架构的改变，来适应时代的发展趋势！



# 最主流的区块链项目



比特币的发布时间为 2009 年 1 月 9 号，预计它的挖矿可以一直持续到 2140 年，发行总量收敛到 2100 万。比特币的出块时间是 10 分钟，出块时间是指全网平均产生一个区块的时间间隔。
3,以太坊是一个区块链应用平台，它的极大创新在于它提供了智能合约这种可以自定义业务逻辑的工具，智能合约是一种可编程的合约，合约是由用户编写并且部署到区块链上的。以太坊的优势是为全世界的开发者们提供了一种开发工具，这种工具让所有人都能释放出巨大的创造力，所以基本上可以看成：只要是有一定技术基础的开发者，通过智能合约可以随时为以太坊贡献内容。
4,瑞波币（Ripple）是一个比较另类的区块链项目，因为从本质上来说，它更像是一种支付结算协议，瑞波币不需要挖矿，它是通过一种叫“Open Coin”的算法，提供瑞波协议共识来达到记账的目的。瑞波币旨在为全球跨境机构提供了高效率的支付过程，提供较好的全球支付体验。因为涉及了机构之间的资产转移，瑞波币被设计成需要准入许可才能进入瑞波的支付网络，这一点有些像我们所说的联盟链
5,莱特币作为比特币的先行者，它会替代比特币做一些具有实验性质的试运行;
6,比特现金作为社区共识分裂的产物，体现了区块链开放共识的特点，你不支持我，我分分钟就可以独立出来。
7,Tether 也是一个特殊的区块链项目，它为所有区块链资产提供了法币（主要是美元）兑换网关。Tether 又称 USDT，言外之意就是和美元一对一锚定，用户存入多少美元，就会产生多少 USDT 进入虚拟资产网络。USDT 可以直接在虚拟货币交易所与比特币等其他区块链资产进行交易;
8,匿名性区块链项目是指：使用交易匿名技术，让公开可查询的交易内容变成私密的匿名性区块链项目。市值比较不错的有门罗币、达世币、Zcash 三种，它们分别使用了不同类型的匿名技术，为区块链技术的匿名特性发展做出了贡献。
9,中国的公链项目不多，分别有 NEO、量子链、元界、公信宝、比原链。





## 问题

区块链项目最先应用的大概率也是金融领域



可以分析一下EOS吗？



区块链主要涉及的领域:金融，物联网，保险，公益领域等,这也决定了区块链大多集中在数字货币上



老师什么时候讲一下交易所。包括，交易所的几种业务形式，背后的功能模块，以及未来的演化方向

作者回复: 第三个专题会专门讲哦



# 深入区块链技术一(技术基础)

区块链虽然是新概念，但是所依赖的技术一点也不新：P2P网络协议➕数字加密算法➕数据库存储➕共识机制。



从技术上看，我们先从生成私钥开始，其次从私钥生成公钥，最后从公钥生成地址，以上每一步都是不可逆过程，也就是说无法从地址推导出公钥，从公钥推导到私钥。

![公私钥.png](https://upload-images.jianshu.io/upload_images/12461256-fb6fe05a4e748e1f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)



区块链化"领域:
物流领域,,从产品生产运输,到商店,到消费;
医疗领域:人的病历跟踪,想过并发症的研究;



1,区块链是一个提供了拜占庭容错、并保证了最终一致性的分布式数据库；从数据结构上看，它是基于时间序列的链式数据块结构；从节点拓扑上看，它所有的节点互为冗余备份；从操作上看，它提供了基于密码学的公私钥管理体系来管理账户;
2,节点之间的数据交换过程不可篡改，并且已生成的历史记录不可被篡改；每个节点的数据会同步到最新数据，并且会验证最新数据的有效性；基于少数服从多数的原则，整体节点维护的数据本身可以客观反映交换历史。
3,区块链在技术上的 7 个特征:

区块链的存储基于分布式数据库；

数据库是区块链的数据载体，区块链是交易的业务逻辑载体；

区块链按时间序列化区块数据，整个网络有一个最终确定状态；

区块链只对添加有效，对其他操作无效；

交易基于非对称加密的公私钥验证；

区块链网络要求拜占庭将军容错；

共识算法能够“解决”双花问题;

4,区块链的类型:公有区块链,联盟链,侧链是一种双向挂钩技术;



PoW：通常是指在给定的约束下，求解一个特定难度的数学问题，谁解的速度快，谁就能获得记账权（出块）权利。这个求解过程往往会转换成计算问题，所以在比拼速度的情况下，也就变成了谁的计算方法更优，以及谁的设备性能更好。



PoS：这是一种股权证明机制，它的基本概念是产生区块的难度应该与你在网络里所占的股权（所有权占比）成比例，目前有三个版本 PoS1.0、PoS2.0、PoS3.0。它实现的核心思路是：使用你所锁定代币的币龄（CoinAge）以及一个小的工作量证明，去计算一个目标值，当满足目标值时，你将可能获取记账权。



DPoS：简单来理解就是将 PoS 共识算法中的记账者转换为指定节点数组成的小圈子，而不是所有人都可以参与记账，这个圈子可能是 21 个节点，也有可能是 101 个节点。这一点取决于设计，只有这个圈子中的节点才能获得记账权。这将极大地提高系统的吞吐量，因为更少的节点也就意味着网络和节点的可控;



加密签名算法:Scrypt,SHA256,SHA3,RIPEMD160 算法;



账户与交易模型:区块链的账本特性，通常分为 UTXO 结构以及基于 Account-Balance 结构的账本结构，我们也称为账本模型。UTXO 是“unspent transaction input/output”的缩写，翻译过来就是指“未花费的交易输入输出”。这个区块链中 Token 转移的一种记账模式，每次转移均以输入输出的形式出现。而在 Balance 结构中，是没有这个模式的。









## 问题

就是在记账的过程中，分布式节点会更新全网的同一个账本，这个账本随着整个网络交易量的增大会量级倍增，这样的话，对于每个节点而言，需要的存储空间会变大。目前区块链对这块是怎么处理的？有没有其他方法？谢谢！

作者回复: 以太坊上有状态分片，比特币可以做区块截断。对于普通用户来说，使用spv就可以了，只需要存储区块头信息



区块链实现主流是什么编程语言？

作者回复: c++和go两种语言为主



公钥到地址为啥要hash一次呢？不能直接用公钥当地址吗

作者回复: 为了提高安全性，直接暴露公钥始终存在风险。



「初次连接到其他节点会被要求按照握手协议来确认状态，在握手之后开始请求 Peer 节点的地址数据以及区块数据。」
请问新加入的节点是如何找到已经存在的节点的呢？是否这里面还是有一个中心化的节点(比如一个大家都知道的域名、网站等等)保存着整个网络中当前有哪些peer节点呢？

作者回复: 你好，这个在不同区块链上的策略不一样，但是大约都会hard code一些节点信息（通常是一组，域名加端口），所以即使初次启动，也可以通过DNS解析获得一些常在线的Peer以供初次启动。例如比特币的核心开发者会公布一些他们的常在线节点，其他公链的项目方也会官方维护一些种子节点，这个在我们元界的主网也有做，官方维护百多个节点确保全球流畅同步。
一旦链上p2p网络，那么就可以从其他peer获得更多的peer地址了。也就是文中的开始请求peer节点的地址数据



关于公链，私链，联盟链对应的共识算法有什么不同，既然区块链是一个提供拜占庭容错的分布式数据库，公链的共识算法包括pbft算法吗？

作者回复: 有的项目使用了变种，这个没有严格定义的。我倾向于不能包括，至少核心算法不能是pbft，pbft的消息传播复杂度是O(n^2)，一个新区块20个节点要传播400次，网络带宽吃不消的。



请问下用Java实现区块链技术，有哪些弊端，目前团队对Java比较熟。

作者回复: 没有弊端，NXT就是Java的。生态可能没有cxx和go丰富而已。



DPOS采用21个节点，还是去中心化么？中心化的信任安全性劣势是不是又存在了？

作者回复: BM特色的去中心化，仁者见仁啦。
DPOS的核心是投票，属于事后处理，而不是预防



像最近阿里百度推出的区块链应用，是没有token机制的吗？

作者回复: 没有。其实就是经典分布式系统的变种。



现在有四个局域网，而局域网间尽可进行文件级的数据传输，那么可以利用区块链技术解决传输过程中数据防篡改、安全一致吗？如果能，网络是不通的问题怎么解决区块链共识？如果不能，能说明下原因吗？谢谢

作者回复: 能，可以参考IPFS协议哦。



底层使用nosql数据库时，其本身自带的分布式机制跟区块链的分布式机制有什么关系？另外，是把完整的账本存在一个集中式的nosql数据库集群里吗？那区块链的各个节点不需要存？

作者回复: 1。算法类似，都必须满足分布式系统的理论要求。实现不同，关键在于是否拜占庭容错
2。不是，所有节点独立冗余



# 深入区块链技术二(P2P网络)

1,P2P 的网络协议:比较常见的有 BitTorrent、ED2K、Gnutella、Tor 等，也就是我们常说的 BT 工具和电驴,快播也是p2p;
2,比特币、以太坊等众多数字货币都实现了属于自己的 P2P 网络协议，但是这种模式并不同于以上讨论的 P2P 网络协议，所以我们今天讨论的重点主要是区块链技术的 P2P 技术，也就是比特币和以太坊的 P2P 网络;
3,P2P 网络技术:区块链的网络连接与拓扑结构、节点发现、局域网穿透与节点交互协议。
4,网络连接除去少数支持 UDP 协议的区块链项目外，绝大部分的区块链项目所使用的底层网络协议依然是 TCP/IP 协议。所以从网络协议的角度来看，区块链其实是基于 TCP/IP 网络协议的，这与 HTTP 协议、SMTP 协议是处在同一层，也就是应用层;
5,P2P 网络拓扑结构有很多种，有些是中心化拓扑，有些是半中心化拓扑，有些是全分布式拓扑结构。比特币全节点组成的网络是一种全分布式的拓扑结构，节点与节点之间的传输过程更接近“泛洪算法”，即：交易从某个节点产生，接着广播到临近节点，临近节点一传十十传百，直至传播到全网。﻿﻿
6,全节点与 SPV 简化支付验证客户端之间的交互模式，更接近半中心化的拓扑结构，也就是 SPV 节点可以随机选择一个全节点进行连接，这个全节点会成为 SPV 节点的代理，帮助 SPV 节点广播交易;
7,节点发现:初始节点发现共有两种方式,第一种叫做 DNS-seed,第二种方式就是，代码中硬编码（ hard-code ）了一些地址，这些地址我们称之为种子节点（seed-node），当所有的种子节点全部失效时，全节点会尝试连接这些种子节点。
8,启动后节点发现:在 Bitcoin 的网络中，一个节点可以将自己维护的对等节点列表 (peer list) 发送给临近节点，
9,黑名单与长连接
10,局域网穿透
11,节点交互协议:命令分为两种，一种是请求命令，一种是数据交互命令
12,节点连接完成要做的第一件事情叫做握手操作。这一点在比特币和以太坊上的流程是差不多的，就是相互问候一下，提供一些简要信息。比如先交换一下版本号，看看是否兼容。只是以太坊为握手过程提供了对称加密，而比特币没有。握手完毕之后，无论交互什么信息，都是需要保持长连接的，在比特币上有 PING/PONG 这两种类型的消息，这很明显就是用于保持节点之间长连接的心跳而设计的；而在以太坊的设计中，将 PING/PONG 协议移到了节点发现的过程中。请求命令一般分为发起者请求，比如比特币中的 getaddr 命令是为了获取对方的可用节点列表，inv 命令则提供了数据传输，消息体中会包含一个数据向量。我们说区块链最重要的功能就是同步区块链，而同步区块恰巧是最考验 P2P 网络能力的。区块同步方式分为两种，第一种叫做 HeaderFirst，它提供了区块头先同步，同步完成以后再从其他节点获得区块体。第二种叫做 BlockFirst，这种区块同步的方式比较简单粗暴，就是从其他节点获取区块必须是完整的。第一种方案提供了较好的交互过程，减轻了网络负担。这两种同步方式会直接体现在节点交互协议上，他们使用的命令逻辑完全不同。















## 问题

节点和区块有什么区别

作者回复: 节点是启动的MySQL服务，区块是里面的表



请问区块同步方式1中，先同步区块头过程中就可以进行合法性验证了吗？之后再同步区块体就直接复制吗？
每个区块头里面不都包含对上一个整个区块的哈希吗？

作者回复: 每个头都包含上个区块的整块哈希的。

请问，同步区块的第一种方法，先同步区块头时就进行合法性验证吗？之后再同步区块体就直接复制吗？

作者回复: 先同步头可以简单验证交易的存在和有效，完整同步依然要检验交易的有效性。



根据节点的发现机制，完全可以爬取所有节点的信息

作者回复: Sipa有一套简单的代码，叫bitcoin-seeder。可以参考



比特币使用的是Gossip算法，以太坊使用的是Kademlia算法
还有 为什么老师说tcp/ip是应用层，在osi模型里，tcp是传输层，ip是网络层。

作者回复: 区块链其实是基于TCP/IP网络协议之上的，这与HTTP协议、SMTP协议是处在同一层，也就是应用层。

这里说的是区块链，不是TCP/IP哦，是说区块链的P2P网络协议在应用层。



NDN+区块链是否能从ip层改变整个网络架构？



没有公网IP的两个节点不能用TCP直接互通吧？用UDP可以打洞来直接互通，不知有哪种区块链支持UDP打洞？

作者回复: 有的呀，uunp协议



请问1、一个节点要与多少个节点保持长连接？2、如果一个节点发起广播，如何保证不被其他节点循环广播同一个消息

作者回复: 你好，这个是算法可配置的，一般是8个或更多。



两个问题请教：bitnodes.earn.com显示比特币网络上才1万出头的节点，会不会太少有安全问题；另外，有很多节点的NETWORK显示Hangzhou Alibaba Advertise Co.，Ltd，这是因为这些矿工运行在阿里云的原因？

作者回复: 一万个节点是全节点，属于核心节点，类似电信的骨干网络。算上轻节点，不开放的节点，可能在百万以上。
是的，很多开发和测试节点会在云上搭建，生产环境也首选在云上的。



矿工解出一个区块后获得记录近期交易的权利和收益，那么在挖出前，交易记录保存在普通节点还是核心服务器上?矿工成功打包交易信息的首次广播人是谁?

作者回复: 保存在矿池的服务器上，叫做memory pool。首次广播就是挖出块的矿工自己



# 深入区块链技术三(共识算法与分布式一致性算法)

1,分布式系统面临了几个问题：一致性问题，可终止性问题、合法性问题。可终止性可以理解为系统必须在有限的时间内给出一致性结果，合法性是指提案必须是系统内的节点提出。当然其中面对的最重要也是最基础的问题，就是我们常说的一致性问题。一致性是指在某个分布式系统中，任意节点的提案能够在约定的协议下被其他所有节点所认可。

2,一致性也分严格一致性、最终一致性

3,遇到问题:非人为恶意的意外投票过程,人为恶意篡改投票过程;

4,有关分布式系统的定理:第一个是 FLP 不可能性，简单来说是：即使网络通信完全可靠，只要产生了拜占庭错误，就不存在一个确定性的共识算法能够为异步分布式系统提供一致性。换句话来说就是，不存在一个通用的共识算法可以解决所有的拜占庭错误。第二个是 CAP 定理，CAP 定理是分布式系统领域最重要的定理之一，这个我们在“理解区块链的常见误区”一文中稍微讲到过。也就是在设计分布式系统的过程中，“一致性”“可用性”“分区容忍性”三者中，我们只能选择两个作为主要强化的点，另外一个必然会被弱化。
5,最终一致性不要求严格的短时间内达到一致。为了其他两个指标，我们相当于让一致性在时间上做了妥协。区块链满足了最终一致性，而且处理过程时间比较长。
6,从软件架构上也经历了基于 ESB 的模块化 SOA 模式，到无状态的微服务架构。从工程的角度来看，根据业务需求达到 4 个 9、6 个 9 就足够了，只是肯定比不了区块链近乎 100% 的可用性。
7,分区容忍性在企业内部极少出现，尤其是中心化的服务性应用，所以很少考虑。然而区块链的 P2P 网络环境十分复杂，所以必须要保证很高的分区容忍性;
8,经典分布式一致性算法有 Raft 协议，Raft 协议是一种强 Leader 的一致性算法，它的吞吐量基本就是 Leader 的吞吐量，它无法抵御节点恶意篡改数据的攻击。
9,Paxos 协议，Paxos 能提供不同场合不同种类的一致性算法，所以 Paxos 有很多变种，经典 Paxos 是 Leaderless 的，有变种是强 Leader 型的，叫做 Fast Paxos，
10,PBFT 全称实用性拜占庭容错系统（Practical Byzantine Fault Tolerance, PBFT)，PBFT 是一种状态机，要求所有节点共同维护一个状态，所有节点采取的行动一致，PBFT 非常适合联盟链等对性能具有较高要求的场合，超级账本项目中的 Fabric 框架默认采用的就是 PBFT 的修改版本;
11,区块链中的共识算法目前具有工业成熟度的是 PoW，另外两种比较成熟的是 PoS 和 DPoS，其次还有一些变种和单一币种使用的共识算法，例如 Ripple 共识、PoC 共识（概念性证明）、PoE 共识（存在性证明）,
12,在使用 PoW 共识算法的情况下，容错阈值是 50%，而 PBFT 及其变种的容错阈值是 33% 左右，这里的百分比是指作弊节点占全网节点的比例。
13,PoX 类的算法其实都延续了 PoW 的设计理念，相比较经典分布式一致性算法，PoX 类算法通过概率选择记账者降低了潜在的提案者，另外是延长了达成最终一致性的时间







## 问题

联盟链基本上使用PBFT及其变种，而公有链大多采用PoX算法，对吗？

作者回复: 嗯，我们理解一致。



区块链行业有哪些公司使用了如 PBFT、Paxos 这样的经典共识算法呢？
PBFT实用性拜占庭容错:联盟链,公链,
PAXOS是一种基于消息传递且具有高度容错特性的一致性算法:阿里巴巴 X-Paxos 



迅雷的公链采用的是Pbft



# 深入区块链技术四(PoW共识)



1,因为比特币采用了 PoW 共识机制，所以这个概念才得以被广泛传播。PoW 全称 Proof of Work，中文名是工作量证明，PoW 共识机制其实是一种设计思路，而不是一种具体的实现。
2,挖矿的基本步骤:
生成 Coinbase 交易，并与其他所有准备打包进区块的交易组成交易列表，并生成默克尔哈希；
把默克尔哈希及其他相关字段组装成区块头，将区块头（Block Header）作为工作量证明的输入，区块头中包含了前一区块的哈希，区块头一共 80 字节数据；
不停地变更区块头中的随机数即 nonce 的数值，也就是暴力搜索，并对每次变更后的的区块头做双重 SHA256 运算，即 SHA256(SHA256(Block_Header))），将结果值与当前网络的目标值做对比，如果小于目标值，则解题成功，工作量证明完成;
3,PoW 挖矿算法大致分为两个大类，第一类叫做计算困难，第二类叫内存困难。
4,PoW 的优势和劣势:
PoW 共识的内在优势在于可以稳定币价，因为在 PoW 币种下，矿工的纯收益来自 Coinbase 奖励减去设备和运营成本，成本会驱使矿工至少将币价维持在一个稳定水平，所以攻击者很难在短时间内获得大量算力来攻击主链。
PoW 共识的外在优势是目前它看起来依然是工业成熟度最高的区块共识算法，所以在用户信任度上、矿工基础上都有很好的受众。
PoW 共识最大的缺点是非常消耗计算资源，耗电耗能源，这一点也一直为人们所诟病。因为每次产生新的区块都会让相当一部分工作量证明白白浪费了，也就是将计算资源浪费了
5,PoW 共识机制是一种简单粗暴的共识算法，它不要求高质量的 P2P 网络资源，它可以为公链提供稳定有效的记账者筛选机制。同时它也面临了挖矿中心化严重的问题，这也促使人们研究出了新的共识机制





## 问题

自私挖，全节点，双花攻击和重放攻击能分别讲解是什么意思吗？

作者回复: 全节点是一个独立节点，可以自己验证交易并且可以挖矿的节点。
自私挖矿是指矿工先通过较大算力积累优势，挖出多的块的同时不广播，等别人广播一个新区块的时候，自己一下广播2个甚至更多区块，让别人一直处于被分分叉的状态，自己成为矿霸，可以形成100%出块率。
双花攻击就是指一个币可以花费两次，属于数据库一致性问题。
重放攻击与传统it的重放不同，是指硬分叉的两条链的交易都是合法的，可以在a生成交易后去b上去花费。



PoS和DPoS就是对pow不环保的改进，不过也带来了新的问题，所以不可能三角还是有一定道理的



现在是不是出了一个ant e3型号的asic矿机是针对ethash的

作者回复: 是的，但效率提升只有两倍，很明显不像其他ASIC提升千倍以上。所以谈不上威胁，毕竟内存困难型的还是吃内存的。



交易是用收款方的公钥加密的，除了收款方可以查看，别人无法看，校验这笔交易的人该如何校验呢？必须是收款方才能校验吗？

作者回复: 你好，并不是用收款方的公钥加密，而是使用收款方公钥的哈希作为地址，通过构造一个交易脚本，使得收款方能辨别并且必须出具签名才能操作。交易都是公开的，所有人都可以验证。具体:发送者通过地址构造一个ScriptPubKey的“锁”，收款方必须构造一个ScriptSig的“钥匙”，才能花费这些币。



一台主机上能不能部多个挖矿机，比如，门罗和ETH，我以为一个是消耗cpu，一个是消耗内存。

作者回复: 可以的，正常矿机就是部署6~8张显卡。目前cpu挖矿的币种极少。









# 深入区块链技术五(PoS共识机制)

Proof of Stake

1,币龄的概念，币龄这个概念其实很好理解，它的英文是 CoinAge，字面意思就是币数量乘以天数。
2,PoS 的实现原理:Hash (block_header) < Target
3,Hash (block_header) < Target * CoinAge我们可以看出多引入了一个变量叫做 CoinAge，也就是币龄，
4,PoS 似乎完美地解决了 PoW 挖矿资源浪费的问题，甚至还顺带解决了 51% 攻击的问题，这里可以顺便讲一下 51% 攻击是什么，它是指 PoW 矿工如果积累了超过 51% 的算力，则可以一定程度篡改账本。
5,早期 PoS 币种基本都采用了分阶段挖矿，有的叫混合挖矿，其实，我并不同意混合挖矿这个说法，混合就意味着同时。很多币种其实是分了阶段的，即第一阶段是 PoW 挖矿，到第二阶段才是 PoS 挖矿;
6,PoW 系统中,，因为任何的分叉都会造成挖矿成本直接变成负收益，所以这会抵抗分叉的产生，矿工倾向于跟随“最长”的链;
7,由于以太坊部分采用了 PoS 共识，它的名字叫做 Casper，它必须解决上述无成本利益问题攻击。所以 Casper 协议要求PoS 矿工需通过抵押保证金的方法对共识结果进行下注，具体实践结果我们还需要拭目以待。



## 问题

哪些区块链项目使用了 PoS 共识机制呢?
点点币（PPCoin）和质数币（PrimeCoin）,恒星币，狗狗币

blk,
rdd
dcr是pow+pos



以太坊用pos





# 深入区块链技术六(DPoS共识机制)

DPoS 全称是 Delegated Proof of Stake，中文翻译过来是代理权益证明。



1,BM传奇;
2,DPoS 共识算法就是将 PoS 共识算法中的记账者转换为指定节点数组成的小圈子，而不是所有人都可以参与记账,
3,只有这个圈子中的节点才能获得记账权。这将极大地提高系统的吞吐量，因为更少的节点也就意味着网络和节点的可控。
4,TPS = transactions / block_timeTPS 表示区块链每秒能确认的交易数， transactions 是由区块大小 block_size 和平均每笔交易大小决定的，而区块大小受全网网络状态 network_bandwidth 限制，也是由记账节点之间物理带宽 witness_performance 决定的
5,DPoS 共识机制本身将“矿池”纳入系统内部，并把它们统称为见证节点，虽然不会出现中心化挖矿的风险，但是 DPoS 由于节点数不多，并且见证节点权力较大，可以认为 DPoS 本身就是带中心化思路的共识机制。



## 问题

可能备选的节点恶意攻击主节点，以谋求上位。
形成21个主节点的联盟，称霸世界。
主节点集中在一个地区，有环境风险。

作者回复: 21主节点的安全问题已经开始被人们所关注了。



如果5G技术得到普及，网络带宽极大提升，是不是就能有效解决记账节点过多时TPS有限的问题？

作者回复: 这是个好问题，好比90年代开发电脑游戏需要抠内存一样，如果到处都是千兆独享带宽，那么简单粗暴提升tps是可以的。



陈老师觉得类似rsk这样的侧链发布智能合约，有哪些缺陷。相比以太坊、eos

作者回复: 抱歉，还不太了解rsk侧链合约哎，可以分享一点资料吗？
直观感受是去中心化的程度受限。



# 深入区块链技术七(哈希与加密算法)

1,哈希算法是一类数学函数算法，又称散列算法，它是一种数据映射关系;
2,哈希算法具有下面的 4 种特性:原像不可逆,难题友好性,发散性,抗碰撞性。
3,区块链上的哈希算法:哈希算法被广泛地使用在构造和验证区块、交易的完整性上，由于哈希算法的四个特性，使得我们可以把任意的交易数据做成数据摘要，然后再一个一个链接起来，形成数据块的链式结构
4,哈希算法的一个重要应用是默克尔树（Merkle tree），默克尔树是一种数据结构，通常是一个二叉树，也有可能是多叉树，它以特定的方式逐层向上计算，直到顶部，最顶层叫做默克尔根，默克尔树最为常见和最简单的是二叉默克尔树。
5,非对称加密算法:非对称加密可以提供一对钥匙，私钥自己保管，公钥可以公开。
6,量子威胁可能不成立;







## 问题

  比特币有三种地址类型：
1、以数字1开头的P2PKH类型
2、以数字3开头的P2SH类型
3、以bc1开头的Bech32类型

其中：
1、P2PKH是支付对PubkeyHash
2、P2SH是支付对脚本散列(Pay-to-script-hash)
3、Bech32是由BIP 0173指定的segwit 地址格式。  



哈希算法和非对称加密相结合可以作为数字签名，这在区块链交易中应用的非常广泛



比特币核心版本源码在哪里可以看到啊？能给个链接？

作者回复: github上搜bitcoin



哈希函数本质上就是把无限的信息映射到有限的空间中。无论摘要用多少个比特存储，终究是有限的。那么就必然存在碰撞的情况。当然，实际应用中这个概率可以忽略不计



比特币地址有哪些类型呢？以太坊的地址又是如何生成的呢？
在比特币中，大多数需要向用户展示的数据都使用Base58Check编码，可以实现数据压缩，易读而且有错误检验。Base58Check编码中的版本前缀是数据的格式易于辨别，编码之后的数据头包含了明确的属性。这些属性使用户可以轻松明确被编码的数据的类型以及如何使用它们。例如我们可以看到他们的不同，Base58Check编码的比特币地址是以1开头的，而Base58Check编码的私钥WIF是以5开头的

以太坊地址生成过程如下：
1. 生成 256 位随机数作为私钥。
2. 将私钥转化为 secp256k1 非压缩格式的公钥，即 512 位的公钥。
3. 使用散列算法 Keccak256 计算公钥的哈希值，转化为十六进制字符串。
4. 取十六进制字符串的后 40 个字母，开头加上 0x 作为地址。









# 深入区块链技术八(UTXO与普通账户模型)

1,账户余额模型与 UTXO 的比较:存储空间，UTXO 占用空间比账户模型高，因为账户模型只记录最终状态。易用性，UTXO 比较难处理，账户模型简单容易理解。例如 UTXO 在使用上，还需要配合高效的 UTXO 组装算法，这个算法要求尽可能降低输入输出的个数，还要让“零钱“归整，算法的复杂度相比账户余额无疑要高。安全性，UTXO 比账户模型要高，UTXO本身具备 ACID 的记账机制，而账户模型需要自行处理，例如重放攻击。
2,UTXO 似乎天然是为数字货币设计的，具有较高频次跨账户转移场景都使用 UTXO 会比较好，考虑到智能合约的普适性，UTXO 与智能合约并不能很好地兼容，但是这也对开发者的自身水平提出了更高的要求。
3,UTXO 的特性及缺点:可表达的状态少, 区块链盲点（Blockchain-blindness）。
 价值盲点（Value-blindness）。
4,UTXO 是比特币上的原生设计，在区块链以前是没有这种逻辑数据结构，UTXO 的出现给了人们看待数据转移的不同视角，但 UTXO 不是所有区块链所必需的，公链开发过程中的是否选用 UTXO 模型可以根据业务场景进行判断







## 问题

历史上 UTXO 或账户模型是否引发过比较严重的使用缺陷呢？

历史上账户模型产生的严重安全问题很多，一类是中心系统的bug，比如前几年发生的光大乌龙事件；另一类是内部腐败，银行内部人员偷偷修改账户的事件也不少见



区块链body中记录的交易是明文还是密文。

作者回复: 你好，区块链交易body是明文带签名，签名部分由自己的私钥签署



Dapp是通过在区块链上部署一层智能合约，然后通过交互而实现智能合约的执行。例如：供应链的追踪以及交易解决方案；预测市场等等都可以通过智能合约来实现。

当我们通过智能合约的时候，这些问题就会迎刃而解。因为，智能合约不会偏向任何一方，也不会知道什么叫“自私”，不会从中多赚我们一分钱。那么这个交易就变得很简单了，买卖双方，通过智能合约的撮合来完成了交易，简单快捷，而且成本降低了。



数据库截断那里，原先的数据删除只保留古老的输入。那不会造成数据丢失吗？

作者回复: 不会，因为已经是共识了，只要重新生成创世哈希即可，重点在未花费的输出（UTXO）



在比特币中将小于 100kb 的交易称为标准交易，超过 100kb 的称为非标准交易。它的前向 input 以及生成一个 out 约占用 161~250 bytes 。所以在比特币中，大约的 inputs/ouputs 的最大数目限制为 100KB/161B ~= 600 个。
---请问这个kb等于KB吗？

作者回复: 你好，是的。



UTXO 的脚本只能看到自己这条历史轨迹，无法看到区块链的数据的全貌，是指无法看到整个区块的货币用量？

作者回复: 对的，是指无法感知其他UTXO，所以组装交易只能用户的钱包来做，而账户模型则没有这个限制，可以是代码处理的。



以太坊的代币算是账户模型的吗

作者回复: 是的，账户模型。



# 去中心化与区块链交易性能

1,TPS = (block_size * network_bandwidth * witness_performance) / (block_time * witness_count)
2,CAP 定理中，C为最终一致性，决定了出块时间的长短。A 是可用性，这个是必选的，必须要保证区块链 7 X 24 X 365 全部可用。
3,Sharding 分片
4,分片技术有以下优势：首先是 TPS 可以从十几笔提升至少两个数量级，也就是千笔每秒，这不但对应用友好，也提升了用户体验；其次 TPS 的提升可以带来更多应用，这些应用在共识的激励下可以水平扩展区块链的性能，形成一种良性循环。
5,网络分片是我们按照网络进行分区，区域内的交易归集在一起并在区域内进行验证，这样区域内的用户可以享受低延迟高吞吐的 TPS，但是会带来跨区域分片的复杂性;
6,状态分片是在以太坊上提出的方案。



## 问题

后续没有看到你介绍DAG的 可以具体介绍一下吗

作者回复: 好的 我后续在专栏追加一篇。已经标记



1、通过增加区块的大小提高tps不能满足要求吗？
2、未来可不可以通过提高带宽和其它物理性能来满足tps的要求？
3、除了当今的区块链，历史上还有没有其他的技术或运动来实现去中心化的目的？结果如何？

作者回复: 1. 区块增长过快的问题

2. 可以。
3. 有，P2P网络工具。



如果dpos的节点本身就是DAC，分布自治社区，那dpos得去中心化效果是不是会更好点。eos的其中一个节点eosdac就是这样的。

作者回复: 链上治理是一个还不太成熟的命题，后面会有讨论



还存在哪些提升 TPS 的方案呢？各有什么样的优劣？
off-chain
大致方案就是交易双方锁定准备金，把海量的交易打包以后上链，链上只保存交易的最终结果。通过智能合约和线下的多重签名机制，作弊方将会被罚没准备金。
闪电网络中锁定的比特币只能用在闪电网络中，只有交易通道关闭的时候才能真正成为链上承认的货币，这在理论上会出现类似银行挤兑的情况。如果大家对闪电网络失去信心，集中关闭通道，会拖垮比特币网络。但，这个似乎也不是很大的问题，只要闪电网络没有爆出什么漏洞，比如说签名算法被攻破之类的。
2.交易是在链外执行，链上无法验证提交的交易是否最新版本，虽然脚本保证了提交旧版本交易的攻击者有被罚没准备金的风险，但前提是要防御者监控网络并提交更新版本交易的证据。也就是说从原来比特币的被动防御（私钥不丢失就能保证资金安全）转变成主动防御。从这个角度看也算是降低了Security吧。这个主动防御的操作交给用户也不太现实，最终必然会衍生出一些服务公司，代替用户保存链外交易凭证，并防止作弊。某种意义上面又从“去中介化的信任”转变为需要信任中介了。这个角度看，似乎也是牺牲了Decentralization。
3.闪电网络中只有保存最终的资金状态保存，中间的交易细节全部被忽略，支持者认为是保护了用户的隐私，反对者认为是损失了交易数据。
4.因为通道需要准备金维持，不可能任意两个用户间都存在交易通道，用户之间转账可以通过中转的方法，最终很可能会有大资金形成中心化的中转节点。



# 智能合约与以太坊

1,区块链领域的合约表达的是可以“自治自理”的 计算机协议，这套协议具有自我执行、自我验证的属性。
2,智能合约等价于一段事先就被规定好逻辑和条款的计算机代码被激活运行的状态，同时，智能合约也提供了通用的用户接口，用户可以通过接口与用户交互。
3,智能合约是一个由计算机处理、可执行合约条款的交易协议，其总体目标是满足协议既定的条件，例如支付、抵押、保密协议;
4,智能合约虚拟机 EVM 和 Solidity 编程语言;
5,智能合约包含两部分，一部分是开发语言，主要以 Solidity 为主，Solidity 与 Javascript 语言在使用上十分接近，这极大地降低了 Dapp 开发人员的学习成本。
6,以太坊 Ethereum 项目的目标是打造一个去中心化的新一代互联网应用平台，这个平台称作 Dapp 平台。
7,以太坊上的账户有两种类型，第一类叫做合约账户 CA（Contracts Accounts)，第二类叫做外部账户 EOA（Externally Owned Accounts）;
8,区块链四大核心技术要素，即 P2P 网络、共识机制、账户模型、加密模块。





## 问题

请问叔伯块（uncles）奖励机制为什么能起到制约中心化挖矿的作用？我记得以太坊区块链一个区块好像只能关联2个叔伯块。

作者回复: 因为可以让矿池更分散，不至于过度集中。从排除的角度考虑，即使没有出块的矿池，也排除了错误的答案，仍旧奖励的话就会鼓励矿池更算力分散而不是集中。



以太坊钱包Mist、以太坊应用浏览器、以太坊客户端这三者之间的关系是怎么样的？他们各自对于开发的作用在哪里？



矿工执行智能合约，为什么不直接消耗以太币，而是Gas，Gas机制的目的是什么？

作者回复: 为了平衡合约执行的



如果有bug的合约程序发布到区块链中，是不是会产生持续性的不良影响

作者回复: 是的，只能升级重新部署



请问eos的账户设计是否参考了eth，分为真人账户和合约账户两种

作者回复: 我认为是的，你可以去测试网确认一下。



# 搭建自己的智能合约

## 搭建一条智能合约

以太坊又称以太坊钱包。以太坊钱包提供了包括账户管理，以太坊转账、Dapp 部署与使用在内的一些常规功能。

以太坊社区提供了多种语言实现的客户端和开发库，多数客户端支持 JSON-RPC2.0 标准，目前支持的客户版本有 Go-ethereum（Go 语言）、Parity（Rust 语言）、Cpp-ethereum（C++ 语言）、Ethereum-lib（Javascript)、EthererumJ(Java 语言)、Pyethapp（Python 语言)，基本涵盖了主流编程语言。



官方推荐使用的版本是 Go-ethererum，这是 Go 语言实现的版本，又称 Geth 客户端

1.下载与安装 Geth

安装成功后，我们可以查看 Geth 的版本

2.搭建以太坊私链

如果在以太坊的主网上运行和开发测试智能合约，这是不明智的，因为会消耗真实的以太币，不过我们可以使用 Geth 搭建一条属于自己的以太坊区块链，也就是以太坊私链。

`   {
"config": {
    "chainId": 98,
    "homesteadBlock": 0,
    "eip155Block": 0,
    "eip158Block": 0
},
"difficulty": "200000000",
"gasLimit": "2100000",
"alloc": {
    "7df9a875a174b3bc565e6424a0050ebc1b2d1d82": { "balance": "300000" },
    "f41c74c9ae680c1aa78f42e5647a62f353b7bdde": { "balance": "400000" }
}
}`

    $ geth --datadir /root/geth-test/ init genesis.json

我们就初始化了属于自己的创世区块信息。

接下来我们创建一个账户，由于是用户私链挖矿，只有你一个人挖矿，所以使用 CPU 挖矿完全没有问题。

 $ geth --datadir /root/geth-test/ --networkid 98 console

personal.newAccount()

我们创建了一个新账户，这个账户就是 EOA 账户，并通过 eth.getBalance 获取了当前地址的余额，显示为 0。

输入 Exit 退出后，我们开始以挖矿模式启动，这里我们最好记录一下我们的地址：【0xf8f7ff845596f0bab1e973859bfcaec6cd2a82ab】

我们使用如下命令启动挖矿，注意在 Etherbase 的地方填上述地址：

`$ geth --datadir /root/geth-test/ --networkid 98 --mine --minerthreads=1 --etherbase=0xf8f7ff845596f0bab1e973859bfcaec6cd2a82ab`

以太坊的 PoW 挖矿算法是内存困难型的，首先需要生成 DAG，这个视你设备的性能而定，需要耗费一定时间，请耐心等待，如下图所示，我们可以看到 DAG 生成非常耗费时间。

在我的远程开发机上一共耗费了 6 分半，又经过了 4 分钟，我挖到了第一个块，如下图所示。

这期间机器的负载如下。

现在我们再去检查一下 Etherbase 所指向地址的余额。

可以看到已经有 5 个以太币了，以太币的最小单位 wei，所以 5 后面 18 个零表示 5 个以太币。

3.编写并部署属于自己的智能合约

智能合约的开发与钱包是独立的，用户可以使用 IDE 进行调试等操作，目前 Dapp 的 IDE 并不多，常见有 Truffle、Embark、Remix 几种；

这篇文章中，我并不使用 IDE，这里仅仅会给出一些示例代码，即经典的 Hello Word，你如果想尝试编写自己的智能合约，可以使用在线 IDE。https://ethereum.github.io/browser-solidity/。

首先我们要获取 Solidity 编译器，通过 apt-get install solc 来安装。安装成功后，我们新建一个 Solidity 源码文件，命名为 helloword.sol，并且写入代码如下。

`pragma solidity ^0.4.11;
contract helloWorld {
function renderHelloWorld () returns (string) {
 return 'helloWorld';
}
}` 

执行 solc --bin helloword.sol 获得 EVM 二进制码。

编译器警告我们暂时不必理会，接下来我们还需要生成 ABI 部署参数，使用命令 solc --abi helloword.sol。

开始部署，我们进入 console

定义 code 和 abi 两个变量如下，注意 code 的值最前面有 0x，二进制数据是用十六进制表示的。

` >code="0x6060604052341561000f57600080fd5b6101578061001e6000396000f300606060405260043610610041576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff168063942ae0a714610046575b600080fd5b341561005157600080fd5b6100596100d4565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561009957808201518184015260208101905061007e565b50505050905090810190601f1680156100c65780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6100dc610117565b6040805190810160405280600a81526020017f68656c6c6f576f726c6400000000000000000000000000000000000000000000815250905090565b6020604051908101604052806000815250905600a165627a7a72305820fcce0b6910e479539e4796b7d56620a6f90e03ba47449c843bec54958f68bf700029"

>abi=[{"constant":false,"inputs":[],"name":"renderHelloWorld","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"nonpayable","type":"function"}]`      

可以在控制台分别执行，由于结果比较长，这里就不放出来了。

`  // 这一步解锁账户，用于方便部署合约 

  >personal.unlockAccount("0xf8f7ff845596f0bab1e973859bfcaec6cd2a82ab")
  >  // 使用上述定义的abi变量生成合约信息
  > >myHelloWorld=eth.contract(abi)
  > >// 注入code信息，激活合约
  > >contract=myHelloWorld.new({from:"0xf8f7ff845596f0bab1e973859bfcaec6cd2a82ab",data:code,gas:1000000})   `

我们可以通过 txpool 来查看未确认的交易。

接下来只要等待出块即可，你的合约就会成为正常运行的合约了，否则合约还不可以调用。

由于我本地挖矿出块异常缓慢，所以我尝试了 Remix IDE，运行后我们可以得到如下结果。

至此一个简单的 HelloWord 智能合约就生成啦，不过它的运行成本非常高昂，所以我们极力建议使用在一些方便的虚拟环境中。

4.智能合约标准模板

当任何人都可以写代码自定义业务逻辑的时候，也就意味着需要一套标准让人们降低开发门槛，标准化的接口让产品之间可以协作。那么我们接下来就来讨论一下以太坊上的三种智能合约标准模板。

这三种模板都与 Token 有关。那么首先我们就来区分一下数字货币与 Token 的概念，数字货币一般指一个区块链项目的平台代币，比如以太坊上的以太币，元界上的 ETP 都是基础代币。

而 Token 往往代表了一种资产，这些资产在已经存在的其他区块链之上运行，资产还可以像商品一样交易，例如消费积分、游戏虚拟资产。Token 离具体的区块链应用也会更近，因为区块链应用的项目方通常也是 Token 的发行方。

目前最广泛使用的三种 Token 标准都是基于以太坊的，它们分别是 ERC20、ERC223、ERC721。这里的 ERC 表示 Ethereum Request for Comments，翻译过来就是以太坊意见征求稿。

(1)ERC20 

2015 年 11 月，V 神在 Github 上提交了 ERC20 代币的技术标准，随后 2016 年到 2017 年，大量的区块链项目都使用 ERC20 作为工具进行 ICO。这使得 ERC20 成为了区块链整个行业内的 Token 标准，可见这种标准的影响之大。

实际上 ERC20 代币是一类运行在以太坊区块链上的智能合约，只不过这些合约代码遵循一定的规范，这个规范就是 ERC20 标准，它规定了跨 Dapp 转移 Token、Token 交易以及一些使用接口。

ERC20 一共定义了 6 个函数和两个触发事件，他们都是使用 Solidity 语言编写的。

6 个函数描述了如何转移以及 Token 的相关数据如何被访问，市面上 99% 的 ERC20 Token 都可以找到这 6 个函数。2 个事件提供了 Approve 和 Transfer 的格式化输出。

重点看一看 ERC20 的接口

` // ---------------------------------------------
 // ERC Token Standard #20 Interface
 // https://github.com/ethereum/EIPs/blob/master/EIPS/eip-20-token-standard.md
 // -------------------------------------------
contract ERC20Interface {
 function totalSupply() public constant returns (uint);
 function balanceOf(address tokenOwner) public constant returns (uint balance);
 function allowance(address tokenOwner, address spender) public constant returns (uint remaining);
 function transfer(address to, uint tokens) public returns (bool success);
 function approve(address spender, uint tokens) public returns (bool success);
 function transferFrom(address from, address to, uint tokens) public returns (bool success);
 event Transfer(address indexed from, address indexed to, uint tokens);
 event Approval(address indexed tokenOwner, address indexed spender, uint tokens);
}` 

Allowance：允许多次创建两个不同的地址之间的单向交易，Token 的拥有者可以从此智能合约中提取 Token；Approve：这个函数需要引用 Allowance，顾名思义，它定义了 Token 的拥有者同意创建属于自己的交易，这个函数要求两个参数作为输入，分别是花费者的地址，以及发送金额；

BalanceOf：定义了查询目标地址账户余额的接口；

Transfer 和 TransferFrom：定义了 Token 如何转移以及执行转移过程；

TotalSupply：定义了这个 Token 最大发行量。

上面我们简要介绍了 ERC20 标准合约的接口，下面我们来看看升级版的 ERC20。



(2)ERC223

在某些情况下，ERC20 也有些缺陷。例如某人使用 ERC20 发送 100 个 Token 到另外一个账户，如果目标账户是一个合约账户，目标账户的合约代码如果不兼容 ERC20 标准怎么办呢？这一点非常有可能，由于合约代码无法识别交易，所以这笔交易就会被拒绝。

以太坊使用的并不是 UTXO，这意味着合约之间不满足 ACID，那么很遗憾，发送方的这 100 个 Token 就永久地丢失了。

非官方的社区开发者提交了 ERC223模板，可以解决这个问题，使用者需要把既存的 ERC20 合约升级到 ERC223 合约。



(3)ERC721

2018 年初，有一个区块链游戏火了，叫做以太坊养猫游戏，这个游戏也是一个智能合约。它基于 ERC721 标准，实际上它也是一种 Token 标准。

ERC721 与 ERC20 最大的区别是：ERC721 定义了每一份 Token 都是唯一的，它们有唯一的标识。例如芒果和米饭是两种不同属性的资产，从物理世界来看，他们是不能直接混在一起使用的，我们不能把芒果加到大米中。

这样一来，ERC721 中 Token 的含义也转变成了一种物权所有权凭证，不再是 ERC20 中的同质资产。





手把手教你搭建了一条以太坊私链，并告诉你如何编译和部署智能合约，最后我还介绍了三种流行的智能合约模板，希望能帮助你上手并能深入地理解智能合约。



## 问题

除了以太坊之外，还有哪些主打智能合约的区块链项目呢？



以太坊一般都搭建在Ubuntu上哪？其他Linux可以不？另外想写一个智能合约，用C++可以嘛，部署上有没有什么需要注意的地方？谢谢！

作者回复: 当然可以，你需要从以太坊官网下载对应的版本。
需要用solidty哦，不可以用C++。EOS上你可以用C++



truffle不是solidity的一个框架吗？

作者回复: 啊，不好意思，我更正一下，感谢纠正。



能在windows下做这个智能合约的开发么？

作者回复: 你好，当然可以的，参考metamask



私链上挖的以太币是真的Ether吗？还是demo的没有价值的币？

作者回复: 是后者



hyperledger也是主打智能合约的，但不需要挖矿，更适合作为联盟链使用



# 区块链项目详解(比特股BTS)

1,比特股是一个公开透明的、7*24 小时不间断运行的、基于区块链技术的去中心化交易平台。
2,比特股的两个机制:第一、资金出入是由承兑商来支持的，人人都可以成为承兑商，也就是人人承兑；第二、锚定机制提供了稳定货币的出入金过程，锚定机制也保证了比特股的出入资金和交易撮合是分离的，避免了中心化交易平台的弊端。
3,人人承兑:人人承兑就是提供了从法币到系统内置货币的转换，比特股系统内置了多种货币，它锚定了多数法币。
4,锚定机制是一种去中心化的抵押机制;
5,比特股的核心代码是由 Cryptonomex 公司开源的石墨烯（Graphene）框架演变而来，它的主体代码是 C++ 编写的，里面使用了大量的 boost 库组件，如果你对石墨烯技术感兴趣，并且熟悉 C++，可以仔细研究一番。







## 问题

27个服务器，理论上tps可以到10万，就是分布式架构，可以这样理解么？

作者回复: 可以的，多了代币在里面



锚定机制有点儿难理解呀…

作者回复: 是的呀



是不是可以通过学习比特股的金融合约代码来学习他的核心呢？也加强对金融概念的了解

作者回复: 是的，可以的哦。主要是抵押的概念



# 引人瞩目的区块链项目(EOS,IOTA,Cardano)

1,EOS 全称 EOS.IO 软件，EOS 也是 EOS.IO 上的平台代币缩写，它暂时没有准确的中文翻译，中文社区把 EOS 叫柚子，这一点其实得益于 EOS 的发音与水果“柚子”相近。
2,EOS 是一个以太坊的竞争型区块链，它提供了全新的区块链架构，使得去中心化平台水平扩容和垂直扩容都成为了可能;
3,DPoS 其实是 BM 参照现实世界中的议会制度而设计的共识算法。DPoS 的核心理念其实是投票，它的设计理念是延迟性惩罚，它假设参与者绝大部分都是没有恶意的。
4,EOS 的争议:Vitalik 针对 EOS 超级节点竞选发表过意见。他认为 21 个节点的 DPoS 虽然引入了治理结构，但也很容易受到选民和持币大户的操纵，最终导致“财阀统治型”的治理结构;
5,埃欧塔 IOTA;IOTA 是一个为了物联网（IoT) 而生的区块链项目。严格来说，IOTA 不是“区块链”，因为它没有区块，也不是链式结构。
6,Tangle 结构和 MCMC 共识是非常具有吸引力的，它也带来了以下特性:0 交易费,水平扩容,分区再合并;
7,卡尔达诺 Cardano项目最大的特色是由理论研究主导，严格采用数学形式化验证的来证明严谨、安全性的区块链。





## 问题

翻译是用的 EOSLaomao 的版本吧，我参与了这个翻译，据我所知这段翻译还没有被 merge 到 EOS 的主分支上。

作者回复: 你好，参考的是github上eosio下的白皮书哦，好像改为15/21了。



介绍了基本情况。如果能更深度分析就更好了。自己再看的话，应该要结合白皮书

作者回复: 篇幅所限，尽可能抛砖引玉给大家。谢谢支持



# 国内区块链项目技术一览

1,NEO 是一个开放式智能经济平台，它提供了数字身份、数字资产、智能合约三种核心元素用来支持 NEO 智能经济生态;
2,NEO 的通用轻量级虚拟机 Neo VM 具有高确定性、高并发性、高扩展性等优点。

3. 技术特点:NEO 采用了 PBFT 类的共识算法;自成一派的智能合约体系。C# 技术生态;
  Token 体系;
  4,元界是一个关注社会和商业需求的区块链项目，目标是构建以数字资产（Metavase Smart Token）和数字身份 (Avatar) 为基础新型区块链生态;
  5,总体思路是总结人与人、人与资产之间的关系，把总结后的通用需求抽象成模型，然后做到区块链底层供使用者方便使用，这种方式我们叫做 BISC（Buit-in Smart Contract）内置智能合约，它可以降低商业应用在开发和使用过程中的技术风险。
  6,通过 BISC，元界提供了数字资产 MST、数字身份 Avatar、Oracle 以及资产交易的功能，这一切都是围绕资产和人来展开的。
  7,BaaS 是一种快速、方便构建区块链应用的方式。
  8,元界 Metaverse技术特点:延续并扩展了 UTXO 模型;内置 BISC，没有为用户提供自己编写智能合约的功能;PoW 挖矿;内置了数字身份;默认提供 HD 类型的主私钥账户体系。块上限是 1MB，出块速度是 33 秒，提供等价于 ERC20 的 MST Token 体系;
  9,量子链致力于开发比特币和以太坊之外的新型区块链生态，它的目标是通过自行设计，让比特币和以太坊完美地融合在一起，并通过智能合约为人们提供 Dapp 平台。
  10,量子链关注利用区块链技术进行价值传输，首次提出了 VTP——Value Transfering Protocal，价值传输协议的概念;
  11,量子链从技术出发，提供了第一个结合比特币 UTXO 和以太坊 EVM 的区块链技术生态区来解决上述问;
4. 技术特点:基础代币 QTM 与比特币脚本高度兼容，兼具 UTXO 和账户模型的优点。与以太坊智能合约体系高度兼容的技术栈。共识算法使用了 PoS3.0 算法，属于经典 PoS 算法。提出了主控智能合约和普通智能合约的概念，通过主控合约可以引入链外数据 Data-feed。通过主控合约可以提供合规性需求。提供了等价于以太坊 ERC20 的 QRC20 Token 体系。
  13,比原链是一种多元的资产交互协议。
  14,比原链认为在区块链上存在两种不同形态资产:比特资产,原子资产;
  15,比原链采用三层架构。
  16,应用层对移动终端等多终端友好，方便开发者便捷开发出资产管理应用 ;合约层采用创世合约和控制合约进行资产的发行和管理，在底层支持扩展的 UTXO 模型 BUTXO， 对虚拟机做了优化，采用自省机制以防止图灵完备中的死状态；数据层使用分布式账本技术，实现资产的发行、花费、交换等操作;
  17,本体网络是一个主打构建分布式信任体系的区块链项目，支持多链、多系统融合的协议网络，不同的链和不同的系统都可以通过本体的信任协议进行协作。
  18,ONTO 将帮助用户实现包括数字身份管理、数字资产管理、分布式数据交换等综合性功能，ONTO 可以将数字身份与现实身份进行映射关联，用户可以利用这款产品建立自己的数字身份和多维的身份画像，通过密码学算法实现隐私保护。
  19,ONTO三种协议:提供分布式身份管理框架 （ONT ID），一个基于 W3C 的 DID 规范构建的去中心化的身份标识协议。提供分布式数据交易协议 （ONT DATA），用于构建去中心化数据交易应用框架。提供了信用评分协议（ONT Scores)，支持建立开发不同的声誉评价逻辑，提供评级授权与审计功能。
  20,ONTO技术特点:基于账户模型，并保留 UTXO 模型。共识算法采用 VBFT，它是结合 PoS、VRF(Verifiable Random Function) 和 BFT 的全新共识算法。模块化的智能合约，提供 WASM 和 NEO VM 两种。通过 FPGA 加速计算密集型的业务模块。多层跨链的结构设计。提供链上搜索引擎。





## 问题

我觉得当前公有链最大的问题除了安全外，应该是使用场景有限，很难有实际落地的应用。

作者回复: 观点一致。技术上还有可扩展性和tps



公链的三大件数字身份，数字资产，智能合约。其实映生产资料，价值，生产关系。通过生产关系进行生产资料的重组与搭配，创造价值。





# 联盟链和它的困境

1,联盟链源自于 Vitalik 对区块链的概念分类，是他第一次提出了联盟链的说法，联盟链的英文是 Consortium Blockchain。
2,所谓联盟链，就是这个区块链具有准入许可，不像公链，任何人都可以随时进入，准入许可意味着候选节点进入区块链时需要得到已经在网络中的节点的许可;
3,超级账本的代码和组织结构都结构清晰、层次分明。可以说无论从声势还是实力上来说，它都可以完胜公链。
4,超级账本技术框架:1.Hyperledger Fabric,2.Hyperledger Sawtooth,3.Hyperledger Iroha,4.Hyperledger Burrow,5.Hyperledger Indy;
5,4 个辅助性工具是：Cello、Composer、Explorer、Quilt;
6,超级账本:
A,纺布克是由 IBM 提供的，它基于 Go 语言，前身是 Openchain 项目;
B,锯齿湖也是一个高度模块化的区块链技术框架，它基于 Python 语言，1.0 版本之后和纺布克一样，作为一套稳定的框架，它已经有了实际的应用了。
C,掘地者也是一个基于以太坊 EVM 的智能合约执行引擎的区块链技术框架，最初项目名叫 Eris，它是基于 Go 语言构造的。
D,伊路哈是第一个关注资产创建和管理的区块链平台;
E,因迪也是一个从身份出发去构建一个分布式经济系统的技术框架。
F,联盟链的困境:几乎所有的超级账本项目都是技术主导，技术的强大也让他们忽视了市场的真实需求。联盟链是少数节点之间的活动，它往往退化成微观经济中的博弈，所以利用联盟链构建少数节点之间的协作系统不是一个技术问题，而是变成了如何构造一个稳定的微观经济模型使得协作者可以达成帕累托改进，在这里，技术变成了次要的。









## 问题

联盟链比公有链靠谱，政府，大公司都在用。公有链目前还都是泡沫经济，都还没落地，全是画饼。

作者回复: 你好，我们观点不一致哦。泡沫是一个新行业的必经之路，革新之始。



我觉得联盟链是当前阶段过渡性的区块链技术，它可以帮助企业认识和使用区块链，区块链最终的形态应该是公有链

作者回复: 我觉得未来也会共存，只是联盟链的生态不如公链家，无论是技术生态还是商业生态。



我个人认为，经典分布式技术框架不适合搭建服务于网状生态系统的业务环境，这也是供应链系统一直不是很好的原因，联盟链退化自公有链，保留了区块链先天适合构造网状系统的基因，并且与现有多中心化的商业环境契合，又能发挥经典分布式系统难以依托通证实现的治理，因此更适合企业端的应用

作者回复: 有道理~



我觉得未来会共存。企业级的需要和国家政府的推行会让联盟链有一席之地。胳膊拧不过大腿，就是这个意思。企业一些业务场景也需要联盟链。（例如合约的自动执行，保密需要，审计需要等等）



可以不可以通过区块链建立类似微信群的项目。可以1，不用群主，由群内所有人自主管理。2，只有郡内部人才可看到郡内容，保护隐私。



私有云，公有云，混合云，万变不离其宗



最近还有个新项目 clovyr.io 号称打通公链和联盟链

作者回复: 挺多的，像阿希和NXT也是



联盟链已经好久了没有实际的运用场景

作者回复: 供应链算一个吧



关于BAAS和现有公链（比如比特币）关系，可不可以这么理解：
1）可以基于BAAS平台开发比特币应用，并将应用部署和运行在BAAS中
2）可以基于BAAS平台查询比特币公链相关的信息

而不是直接将比特币客户端部署到BAAS中

作者回复: 是的，这是我的理解，也可以扩展到其他区块链，例如IOTA物联网服务也是可以的。



# 数字货币与数字资产

## 比特币专题1-历史与货币

1,比特币的历史:创立前期、创立期、成长和稳定期。
2,比特币的意义:信用货币;
3,无国界的共识:打破了一般信用货币的局限性;
4,比特币的本职是记账;
5,高效的资源调度;
6,三权分立的社区自治形态:矿工、开发者、投资者三者组成了相互制衡的数字货币的治理形态。
7,技术限制,开发者制衡,投资者制衡;
8,比特币 BIP（Bitcoin Impovement Proposals) 是一种设计文档，用来描述比特币新特性的提案，第一个比特币 BIP 是 2011 年 8 月 19 号一个名为 Amir Taaki 的人提交的，编号 bip001;
9,真正意义上达到了工业级水准的，还是只有比特币。





### 问题

人类天生就倾向于中心化，就像每个领域都有意见领袖、每个行业都有巨头一样。基于此，我觉得是不是中心化并没有那么重要，重要的是要设计一种体质防止中心化的滥用带来的危害。就像比特币，虽然矿池中心化，但是比特币的各种机制设置使得矿池中心化的危害没有那么大，对于eos，我也同样如此认为。



比特币和以太坊本身定位不一样，比特币是更多是作为货币的形式存在的，以太坊是为了解决交易和价值转移而实现的。

本身没有超越之说，但是我更看好EOS的未来，如果说以太坊是价值转移的CPU，那么EOS则是价值转移的操作系统

作者回复: EOS的中心化问题为人们所诟病，具体运营情况我们还需拭目以待。



  以太坊的价值以及能力很可能超越比特，目前 eos 以及 neo 都无法与以太竞争。

就以太而已言，苹果创始人沃兹对以太的评价已经值了。  



  以太坊不可能取代比特币，但青出于蓝胜于蓝，以太坊对智能合约贡献巨大。但性能问题让以太坊很难再突破，江山代有才人出。

人们认识区块链基本从比特币开始，比特币有教科书意义，积累了最多人的信心，目前最成熟的工业级区块链应用，在未来可能成为数字黄金。以太坊取代不了这样的历史地位。  



## 比特币专题2-扩容之争、IFO与链上治理

1,扩容的需求是由于比特币的使用人数逐渐增长，于是比特币的网络也日益拥堵。
2,比特币产生了硬分叉。一条链变成了两条。极端扩容派在比特币主链上硬分叉出一条没有隔离见证的链，分叉之后的币就是比特现金（ BitcoinCash），缩写 BCH，而隔离见证则成了现在我们看见的比特币;
3,知名IFO:比特币黄金,比特币 2x,比特币钻石,超级比特币,LBTC,BTP,GOD,BUM,Bitcoin Silver
4,链上治理
链上治理指的是人们直接在区块链发起社区提案，并进行决策的过程。
这里首先要求的是链上支持基本治理协议，这套协议可以规定或强制执行提案，链上治理直接决定了区块链本身的发展方向。链上治理的参与方包括了投资者、使用者、开发者、矿工四类人群。
链上治理与链下治理的区别在于，区块链本身是否提供强制执行的机制让少数服从多数。
5,EOS 和比特股的治理结构来自于 DPoS 算法提供的投票过程，投票是根据币的数量作为权重的，使用者、投资者、开发者、矿工这四种角色中，其中把矿工和投资者进行了合并，受资本的要挟，风险比较大。



### 问题

既然区块链有链上治理和链下治理之说，那现有区块链项目/公司通常设置怎样的治理结构呢？通常组织架构又怎样呢？😄

作者回复: 除了比特币其他都是中心化运营，通常的模式有基金会和实际执行的公司主体。



人一票的问题是：对某项问题有更深认知的投票的权重应该更大吧。

作者回复: 这其实是政治学问题，如何在社区中合理分配权力。实际的人类社会治理是由精英掌控的，无论是哪种经济体。



从只有少数活跃投票而看，这也就说明区块链技术现在面临的最大问题是：互联网的群发性。石润婷教授提出的鲁棒性。休眠者多于活跃人数，从而影响投票权威。

作者回复: 是的，投票惰性和公地悲剧。感谢分享。





## 数字货币与货币资产

1,截止 2018 年 3 月，全球数字货币共计 1500 多种，总市值超 3200 亿美元。然而市值分布占比不够分散，单比特币就占了一半市值，剩下以太坊、瑞波币、比特币现金等数字货币占了另外一半。
2,数字货币是数字资产的清算底层，数字资产的经济活动依赖数字货币。
3,比特币本身是最成功的数字货币项目，同时也是最成功的区块链项目。
4,比特币的应用生态主要集中在全球无国界支付结算上;
5,原生型数字货币具有如下特点
非营利性社区自治；
依赖社会共识承认；
超级结算工具；
可用于支持数字资产。
6,锚定型数字货币具有如下特点：
商业性自治；
依赖广泛的承兑商；
稳定的支付结算工具；
可用于支持数字资产。
7,基础设施型 Token一般就是指公链的权益代币;
8,金融型 Token
9,特点是在为原生数字资产创造流动性，它是数字金融发展的必然结果。
10,金融型 Token 有点接近证券，只能在流动性高的地方产生，例如数字资产交易所、承兑平台。
11,商业垂直生态型 Token
12,区块链思维:第一类是开放的产品形态，第二类是社区共同治理。
13,Token 依赖关系:
商业垂直生态型 Token 依赖基础设施型 Token；
金融型 Token 依赖基础设施型 Token；
商业垂直生态型 Token 可能依赖金融型 Token。
14,Token 的流动性大小依次是：
基础设施型 Token > 金融型 Token > 商业垂直生态型 Token
Token 的种类数量分布依次是：
商业垂直生态型 Token > 金融型 Token > 基础设施型 Token
15,数字资产的属性分类:普通 Token,价值型 Token;
16,Token 属性:
使用权，表示 Token 可交付产品或服务；
可交易，流动性是数字资产的基本需求；
可升值，这是由第二条带来的附加属性，也就是升值。



### 问题

如果央行基于法币发行一种数字货币，用这种数字货币支持数字资产。那么那些与法币锚定的数字货币还会有价值吗？token可以基于央行的数字货币发行，最后胜出的数字货币可能是央行的数字货币，比特币这种不与法币锚定的数字货币会变成资产，恐怕很难变成支付手段？

作者回复: 你好，你说的其实是稳定货币的话题。目前已有类似产品，叫做Tether。未来极有可能是并存的



## 数字货币交易平台1

1,交易模式分为两种：场内交易和场外交易。
2,场内交易，又称成交单优先模式,交易场所负责用户的资产托管、交易撮合、资产结算、履约担保等功能。
3,投资者流程：
投资者到证券公司开户，然后下单给证券公司；
证券公司再将这些订单传递到交易所，订单在交易所完成撮合成交；
接着交易所将订单和成交数据传到证券登记结算公司，结算公司据此进行资金和证券账户的结算；
结算结果再回传给证券公司，证券公司通过自己的平台显示给投资者，例如成交信息，账户余额等等。
4,数字货币交易平台也叫做数字资产交易平台，主要为人们提供交易数字货币或数字资产撮合交易服务
5,目前流行的法币与数字货币的交易有美元、欧元、日元、澳元等。
6,中心化交易所一般都会提供以下业务模块：充提数字货币、资产托管、交易撮合、资产结算、杠杆交易、KYC 等
7,数字货币交易平台的三种类型:
模式一：中心化模式，资金管理系统与区块链账本各自记账，包含充币提币的过程，需要人工干涉。
模式二：半中心化模式，交易撮合与行情模块是中心化的，而资产是在区块链上直接结算的。
模式三：完全去中心化模式 ，比模式二更进一步，所有模块都是去中心化的，包括交易撮合和行情部分
8,数字资产交易平台一方面是互联网技术与区块链结合的典型案例，另一方面也是数字金融生态最重要的一环，区别于传统金融的券商结构，交易所本身的资产托管结构，让数字金融具备天然的流动性，这是传统金融体系所不具有的特性



### 问题

经济学说：品牌是企业为了给顾客惩罚自己的机会，而创造的一种重复博弈机制。从这个出发点来讲，去中心化的交易所出了问题，由谁承担责任呢？去中心化的交易所走了一条奇怪的路，他们是想用技术来创造出一种永不犯错的东西。但其实对用户来讲，企业犯不犯错，用户不关心，用户关心的是自己的资产如果出现了问题，有没有人来负责，有没有人来补偿。只要企业对错误做出了应有的赔偿，用户就会更信任这个企业。

作者回复: 目前是这样子的。
但是我们不排除任何一种可能性，生产力的发展会打破原有的社会结构也说不定。



最近在研究不同数字货币交易转换的问题。去中心化的手段几乎没有能用的。例如btc转换成eth。不少项目都是开始阶段，让我们拭目以待吧！

作者回复: 去中心化交易的挑战在于交易的原子性问题，由于btc和eth是共识异构的，基本上不太可能出现满足原子性交易的去中心化交易所哦。





## 数字货币交易平台2

1,区块链本身也是用来记账的，也算作一种金融账本，所以一套内部账本，一套区块链本身的账本;
2,数字货币交易所包含哪些系统模块:Web 业务逻辑系统、交易撮合系统、运营后台管理系统、资金管理系统。
3,资金管理系统其实就是内部账本;
4,与传统互联网应用的最大区别里主要是数字货币钱包管理，这块完全是新的内容，对安全性、易用性提出了相当高难度的挑战，这里也是交易所资金托管的根本，所以如何管理好大量数字货币，往往要结合运营、内部管理制度、冷热钱包技术一起才能做好交易所的资金管理。
5,一般数字货币交易所的原则都是“宽进严出”，在充值过程中，交易平台通常不直接使用数字货币钱包检测用户是否充值到账，而是使用“扫块”(block_scan) 这一方法检测用户的充值。



### 问题

关于去中心化的交易所。
我觉得主要在于“资产管理模块”的差异。使用去中心化的方式管理账户。
第一：新建一个自己的区块链，例如wanchain，cosmos等就是这么干的。其他链上的资产可以转移到自己建立的区块链上。优点：并发性好。缺点：社区信任问题，“假”的去中心化问题（PoS共识）。
第二：不建新的区块链。通过atomic swap智能合约合实现。交易记录保存在公链上。问题就是并发性不好，可能有重放攻击，确认时间长。优点：基于公链。



如果我在某交易平台上花1万人民币充值1比特币，这枚比特币只记录在交易所中心化的数据库里，并没有真正在区块链上产生transaction，这样理解对吗？

作者回复: 你好，充值过程是有transaction的，但是充值成功后，你在交易所显示的比特币只是一个数字啦，并不是真的比特币了。



充值是否给每个用户生成一个地址？
用户的余额查询是查询区块还是直接查询数据库，查询数据库的话有充值进来如何触发更新数据库？

作者回复: 是的，应该是每人每次一个地址。
一般查询数据库，这个叫持仓。
通过监听充值交易transaction。



1、交易平台为何不直接使用数字货币钱包检测用户是否充值到账，而是使用“扫块”(block_scan) 这一方法检测用户的充值呢？
2、是因为扫块的方式效率高？
3、以比特币充值为例，是不是需要有6个块确认之后交易平台才显示确认到账呢？

作者回复: 1和2. 首先是性能考虑，因为交易平台拥有庞大的用户基数，如果仅仅只有钱包，显然钱包的性能不足以支持庞大的查询请求。其次是风控角度，针对异常交易检测需要比较精细稳定的查询服务。后续文章会有剖析哦
\3. 是的。





# 区块链与当下互联网

## 互联网身份与区块链数字身份

1,身份记录:一种是资产和消费记录，另外一种是社交记录;
2,历史上经历了三个阶段:印章实物身份,卡片型身份,互联网身份;
3,现阶段的身份问题:如果国家撤销其证书，个人可能会失去他们的身份，身份应当是与生俱来的概念，国家可以选择承认与否，但不应该存在黑户这样的人群。某个中心机构签发的身份证明，往往不能被其他机构所接受。集中控制的身份管理，只能在一个辖区或一个在线服务内有效。
4,互联网虽然提供了信息高速公路，但是并没有提供中立、开放、统一的身份层。
5,互联网身份问题:
身份数据的安全性问题，面临泄露和被篡改的风险。
不同机构之间的身份数据的兼容成本很高，带来身份数据碎片化且不一致的问题。
用户无法控制属于自己的数据，例如你今天发布的照片，并不知道会被哪个推荐系统采用。
重复创建和管理不同应用下的身份，典型案例就是重复注册各种账户。
虚假身份欺诈，这个比较好理解，就是被我的身份被盗用，尤其在账户泄露的时候
6,区块链数字身份必须涵盖身份的两大核心功能：验证和授权;
7,区块链数字身份面临的三个挑战:
如何控制个人身份在区块链上的隐私边界？
现实中会产生庞大的身份数据，区块链无法承载这么多数据该如何解决？
如何兼容上述三种类型的身份，例如已经存在的互联网身份？



### 问题

我觉得区块链数字身份会成为未来整个互联网的底层技术，和其他很多正在发展的区块链项目共同组建起区块链的底层架构，更好的让人们产生的数据，资产，信息互联互通。人们可以全权掌握自己产生的数据并为自己创造价值！

作者回复: One world one dream



如果有了数字身份，用户可以选择是否让第三方用，以及费用，换句话说，数字身份代表的是一种价值，之前依托于商业机构实现转移，现在可以借助区块链自己决定价值的转移。

作者回复: 观点一致，结论很到位。问题是利益问题，目前没有办法从大互联网公司获得主权，只能被动创建新的身份，可能会不兼容，这里挑战也很大



你觉得区块链数字身份会是接下来的热门概念吗？
用户身份自己可以授权,毋庸置疑是最受欢迎的;只是互联网公司是不是推进,这是个时间问题;



前几天知道香港和内地合作的一个项目。把学历信息放到区块链上了，我想这也是一个数字身份在区块链的应用吧！



对于区块链，主要是尝试解决分布式下的信任问题（共识），但这个规则是适用于用户之间的，那么对于系统的创建人是否有控制呢？假如系统的开发人员在系统上留后门，现在有什么解决方案吗？这个问题可能不局限于技术角度，期待老师的解答！

作者回复: 你好，公链代码必须开源，后门什么的，很难隐藏。
开发者只是角色只是，不是唯一的主导者



虽然链上的身份有助于身份验证，但是上链这个过程由谁来认证?

作者回复: 可以是第三方，也可以是原生的。例如证明中本聪则不需要护照和身份证，是基于史实。第三方也是必不可少的，是身份数据的转换迁移过程。



## 区块链即服务BaaS

一线互联网公司更倾向 DLTs 技术，也就是 BTaaS 类，三四线以及业绩边缘化的互联网公司倾向于 Token 为代表的经济生态，也就是 BaaS 技术。下面是我们公司的 Frank 收集分类的国内应用案例，涉及的行业有金融、公益、互联网、食品溯源、物流、电商等领域，我在这里列出来供你参考。

蚂蚁金服区块链，联盟链。蚂蚁金服技术实验室宣布开放区块链技术，支持进口食品安全溯源、商品正品溯源、支付宝爱心捐赠平台。

阿里健康区块链，联盟链。阿里与常州市政府就医疗数据保护达成共识，推出了国内首个在医疗行业的区块链解决方案——阿里健康。

Symbiont，其起源于 Counterparty（合约币）项目，旨在建立第一个用于发行区块链智能证券和交易智能证券的平台。

跨境食品溯源，联盟链。阿里巴巴与普华永道（PwC）达成合作关系共同开发一种使用区块链技术的系统来减少食品假冒。

阿里邮箱 + 法链，公链。将使用名为“法链”的区块链技术，推出基于阿里云平台的邮箱存证产品等。

阿里云 +Hyperledger，联盟链。阿里云上推出了 Hyperledge Fabric 区块链自动化配置和部署的解决方案。

数字雄安区块链实施平台，联盟链。阿里巴巴、蚂蚁金服与雄安签署战略合作协议，将承建“数字雄安区块链实施平台”。

天猫奢侈平台 Luxury Pavilion 溯源，联盟链。阿里云发布区块链解决方案，支持天猫奢侈平台 Luxury Pavilion 推出全球首个基于区块链技术的正品溯源功能。未来消费者只需点击“一键溯源”，便可了解产品产地、入境报关时间等信息。

金链盟 FISCO BCOS 区块链平台，联盟链。由腾讯牵头，集结了微众银行、平安银行、招银网络、京东金融、华为等 31 家企业。旨在整合及协调金融区块链技术研究资源，形成金融区块链技术研究和应用研究的合力与协调机制，提高成员单位在区块链技术领域的研发能力，探索、研发、实现适用于金融机构的金融联盟区块链，以及在此基础之上的应用场景。

微黄金，联盟链。腾讯财付通与工商银行合作，以工商银行的黄金产品为基础，联合推出的在线黄金交易服务。其中，由腾讯提供联盟链的底层技术支持。

公益寻人链，联盟链。将区块链技术应用到公益领域，连接腾讯内部多个寻人平台，实现各大公益平台的信息共享。

星贝云链，联盟链。以腾讯区块链技术为底层打造的供应链金融服务平台“星贝云链”，是国内首家与银行战略合作共建的基于区块链的供应链金融平台，也是国内首个基于大健康产业构建的供应链金融平台。

TrustSQL，联盟链。腾讯发布区块链项目 TrustSQL，旨在以区块链基础设施构建安全高效的解决方案，为企业及机构搭建价值连接器，共同推动价值互联网发展。

腾讯云金融级解决方案 BaaS，联盟链 + 私链。腾讯云发布区块链金融级解决方案 BaaS(Blockchain as a Service)。

这套方案构建在腾讯金融云之上，并整合了腾讯在支付、社交网络、媒体网络、征信平台等业界领先领域的资源在内的解决方案，将在智能合约、互助保险、大数据交易及资产交易、供应链金融与供应链管理、跨境支付 / 清算 / 审计等场景下，为金融用户提供安全、可靠、灵活的区块链服务。

腾讯云 +Hyperledger，联盟链。腾讯云加入 Hyperledger，参与国际区块链生态建设，推动区块链技术以及相关标准的制定。

区块供应链联盟链 + 云单平台，联盟链，腾讯与中国物流与采购联合会（简称“中物联”）签署了战略合作协议，并发布了区块供应链联盟链及云单平台。

京东区块链平台，联盟链。京东发布自己的区块链平台，愿景是协同盟友构建新一代基于互联网的“可信价值传递基础设施”，服务于商业数据的高效可信传递。与此同时，京东积极推动自身的零售和供应链大数据“上链”，通过场景数据在区块链中的传递，助力基于区块链技术实现规模化应用，建立社会化跨主体共享的区块链联盟链网络。

国内信用证信息传输系统，联盟链。苏宁银行加入由中信银行上线的国内首个区块链信用证信息传输系统，成为联盟成员。

区块链黑名单共享平台，联盟链。苏宁金融宣布上线基于区块链黑名单共享平台系统，即采用超级账本 Fabric 联盟链技术，将金融机构的黑名单数据加密存储在区块链上，金融机构可通过独立部署节点接入联盟链，开展区块链黑名单数据上传和查询等业务。

小米移动 +Hyperledger，联盟链。北京小米移动软件加入超级账本项目。

网易星球，区块链应用。网易星球为用户构建星球居民身份，集合用户的社交、娱乐、购物、出行等相关数据（实际跟区块链技术并无天多关系）。

玩客云，区块链应用。迅雷推出基于区块链技术的玩客云共享计算生态、CDN 共享经济，并发行代币玩客云（现已改名链克，停止了内地转账功能）。

迅雷链，公链。迅雷发布了拥有百万级并发处理能力的区块链项目——迅雷链。采用独创的同构多链框架，在业内率先实现了链间的确认和交互，不同交易可以分散在不同链上执行，从而达到百万 TPS。

暴风播酷云，区块链应用。它是一台可以赚取 BFC 积分的家庭私人影院智能终端。在非工作状态下，用户通过闲置的存储空间和宽带帮助暴风系列软件、第三方 CDN 业务、第三方区块链业务进行超大文件网络加速甚至区块链网络全节点部署，不仅可以共享资源，还可以赚取 BFC 积分。



1,比特币提供了价值存储和价值传输的功能;
2,IBM 和微软曾经提出过 BaaS 的概念，它也对标 PaaS，这里的区别在于客户是使用区块链技术框架构建起属于自己的联盟链，还是使用公链上的服务。
3,架构集成与快速构建挑战困难:第一、系统级的多币种私钥管理体系。第二、稳定可控的区块链服务;
4,互联网公司在区块链领域的尝试:蚂蚁金服区块链，联盟链,阿里健康区块链，联盟链,Symbiont,跨境食品溯源,阿里邮箱 + 法链，阿里云 +Hyperledger,数字雄安区块链实施平台,天猫奢侈平台 Luxury Pavilion 溯源,金链盟 FISCO BCOS 区块链平台,微黄金,公益寻人链，星贝云链,TrustSQL,腾讯云金融级解决方案 BaaS;



### 问题





## 数字货币钱包服务

1,数字货币钱包的分类;
2,扫描区块技术 Block scan;
3,构成区块链的四个核心技术是：P2P 网络协议、分布式一致性算法、加密签名算法、账户与交易模型。
4,扫描区块技术解决了所有区块链资产可视化、高并发查询的问题，所以它在一些大规模的数字货币交易所中也有应用。
5,区块浏览器:从技术上看，一个区块浏览器的主要工作就是把区块扫描到数据库服务器中，然后搭建一个 Web 访问服务，用户只需要输入交易哈希或者区块哈希，即可查询到交易是否已经被打包和确认。
6,数字货币钱包服务:实际上，大规模的区块链应用都需要搭建一个数字货币钱包服务，数字货币钱包服务为系统中的其他模块提供了可扩展的、统一的、安全的交易查询和验证服务。



### 问题

数字货币钱包服务可以应用到微服务架构中吗

对区块链有写操作的应用，很难用微服务，因为是有状态的。而区块链的读服务或基于中心库查询的web服务，完全可以用微服务。



这里最难以处理的问题是保持 MySQL 中的区块数据与全节点数据的一致性
这个是定期扫描么 还是时时刻刻有变更就扫

作者回复: 取决于业务敏感性吧。一般是做分叉检测和控制入库高度，不过应该不是最优解决方案



数字货币钱包服务可以应用到微服务架构中吗？
微服务治理,链路追踪,与这个功能相似;



## 区块链与供应链一

1,供应链围绕核心企业与产品构建，是一个从供应商开始、途径制造商、运输商、分销商最终到消费者的网链状结构。
2,在这个链式结构中，有信息流、物流、资金流三种流动过程。
3,供应链金融 (supply chain finance, SCF) 可以泛指各种融资工具，它可用于为供应链中的各方提供资金，通过短期信贷手段来平衡上下游之间的流动资金差，从而最大限度地减少总供应链成本，企业也可以利用供应链融资与供应商建立更牢固的关系，降低金融风险和提高流动性。
4,区块链在供应链中的切入点往往是从物流切入的，因为物流是连接各方最直观的表现，也是关系最紧密的;
5,供应链案例:
马士基（Maersk）和 IBM 的海运保险区块链平台案例；
沃尔玛利用区块链进行食品追踪溯源案例；
众安的区块链养鸡场实时记录和追溯整个鸡的成长过程案例；
海航科技基于区块链技术的物流端到端的虚实融合信息流平台。

### 问题

区块链在物流上的应用必须结合IoT技术，请问老师，IoT技术现在的发展状况如何？



隐私问题，如何使企业的数据只有参与方才能看下到，其它无关企业特别是竞争对手不能看到；因为不同国家对数字货币的政策不同，如何在区块链化的供应链金融中实现支付也是一个问题。

作者回复: 赞同。



库存管理问题，下游需要多少货，上游可以直接查询到，然后按需排产

作者回复: 信息真实可靠交换也是一个思路





## 区块链与供应链二

1,跨境物流问题
2,基于分布式账本技术 DLT 的解决方案
分布式账本技术，英文全称是 Distributed Ledger Technology，缩写为 DLT。DLT 技术是联盟链的首选技术，在 DLT 技术中，关注点不是 Token，而是核心业务可编程逻辑，所以 DLT 技术可以看成是区块链技术的一个变种。
3,DLT 技术的局限性
仍然围绕核心企业展开，通常只解决了单个问题，也会面临传统技术相同的问题；
DLT 价值孤岛，由于 DLT 平台太多，会造成数据孤岛，DLT 平台之间并没有打通，面临着天花板。
4, DLT 技术优势:
能解决实际问题，可以快速落地；
有行业巨头的大力支持，可以和现有供应链管理工具栈无缝对接。
5,基于公链的解决方案
   订单匹配. 货物追踪
6,公链方案与DLT 技术相比，具备以下优势
透明度高,不可篡改性,Token 转移,参与性强,共享公链的基础设施
7,DLT 技术与公链方案相比
可控性高：DLT 技术一般严格控制参与方，核心企业的权益可以得到保障。
可快速落地：方案和思路延续传统技术，实施起来方便，对参与方的认知门槛要求低。
匿名性较好：一般公链并没有提供清晰的权限管理和匿名技术，所以企业的数据必须脱敏才可以明文上链，而 DLT 技术不存在这个问题



### 问题

我的观点是当前阶段应该还是会以DLT为主，因为由大型企业牵头，更容易落地。但随着公链技术的发展，特别是TPS的提升，公链会逐渐成为主角。



介绍一下你们做元界的时候，技术选型是怎么考虑的？我们在技术选型上由以太坊到Tendermint系列，未来考虑casper协议的以太坊或者eos，还有一个限制是底链开发人员不足。

作者回复: 你好，我们是2016做的，那时候以太坊发生了TheDAO事件，可以参考的技术不多，认为以太不够成熟，所以没敢用。
目前来看，石墨烯技术是很好的选择。还是要看场景



# 如何从业区块链



职业性格测试

## 需要了解什么

1,行业现状;
2,人才现状
技术决策者，这类主要指 CTO、技术总监、技术专家等；
代码生产者和维护者，也就是广大 IT 从业者、开发工程师；
需求产生和归纳者，产品经理、需求分析师；
交互与可视化，前端工程师、UI/UE 与视觉设计等；
产品运营，实际与用户接触，吸纳和维持用户。
3,明确与制定自己的发展方向

### 问题

我个人很喜欢研究经济金融，想从事区块链金融方面的工作，都需要哪些方面的知识，往哪个方向发展比较合适，哪些工作对编程，写代码的要求比较低一些。

作者回复: token设计，代币经济学，微观经济学，产品设计等等。未来的产品肯定是融合了微观token在内部的。



在实际的求职过程中，我发现直接招聘dapp、智能合约岗位的很少，即使有也是归类为前端，少有原生app开发者转型机会，我目前在做自己的dapp准备上线，不知这样是否能有机会或是有何更好的方法，请老师指教。

作者回复: dapp只是业务的一环，不是全部。梳理业务关系，选取合适技术实现是最重要的。智能合约其实并不需要很多，一般就是token和空投之类





原文: [Working with Files in Go](http://www.devdungeon.com/content/working-files-go#write_bytes), 作者: [NanoDano](http://www.devdungeon.com/blogs/nanodano) 





